<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GeoRanks ‚Äî Global Ranking Challenge üåç</title>
  <link rel="icon" href="assets/favicon.png" type="image/png">

  <!-- Fonts and Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/game-modes.css" />
  <link rel="stylesheet" href="css/home.css" />
  <link rel="stylesheet" href="css/mode-selector.css" />
</head>

<body>
<div class="home-glass-header">
  <a href="auth.html" id="signInText" class="sign-in-text">Sign In</a>
  <div class="menu-icon" id="menuToggle">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<!-- üîí PREMIUM UPGRADE MODAL -->
<div id="premiumModal" class="premium-modal hidden">
  <div class="premium-window">
    <h2>Premium Feature <span class="lock">üîí</span></h2>
    <p>These categories are only available with <strong>GeoRanks Premium</strong>.</p>

    <button id="goPremiumBtn" class="premium-btn upgrade">Upgrade to Premium</button>
    <button id="closePremiumBtn" class="premium-btn cancel">Return Home</button>
  </div>
</div>

<div class="home-wrapper">

  <!-- Main Header -->
  <header class="home-header visible">
    <div class="logo-wrapper">
      <img
        src="assets/logo.png"
        srcset="assets/logo.png 2x, assets/logo.png 3x"
        alt="GeoRanks Logo"
        class="logo fade-in"
      />
    </div>
    <p class="tagline fade-in">Test Your World Ranking Knowledge! üåç</p>
  </header>

  <!-- Hamburger Overlay Menu -->
  <div class="menu-overlay" id="menuOverlay">
    <div class="menu-panel">
      <h2>Menu</h2>
      <button class="menu-btn menu-btn-account" onclick="window.location.href='account.html'">üë§ Account</button>
      <button class="menu-btn" onclick="window.location.href='categories.html'">üéÆ Categories</button>
      <button class="menu-btn" onclick="window.location.href='leaderboard.html'">üèÜ Leaderboard</button>
      <button class="menu-btn" onclick="window.location.href='stats.html'">üìä My Stats</button>
      <button class="menu-btn" onclick="window.location.href='how-to-play.html'">üí° How to Play</button>
      <button class="menu-btn" onclick="location.href='feedback.html'">üí¨ Feedback</button>
      <button class="menu-btn" onclick="location.href='contact.html'">üì© Contact Us</button>
      <button class="menu-btn upgrade-access-btn" onclick="window.location.href='premium.html'">üîì Unlock All Categories</button>
      <button class="menu-btn menu-close" id="closeMenu">Close</button>
    </div>
  </div>

  <!-- DAILY CHALLENGE -->
  <section class="daily-challenge-card fade-in" id="dailyChallengeCard">
    <div class="daily-info">
      <h2>üìÖ DAILY CHALLENGE</h2>
      <h3 id="dailyChallengeTitle">Loading...</h3>
      <a href="#" id="dailyChallengeBtn" class="btn-primary glow">Play Now</a>
    </div>
  </section>

  <!-- CATEGORIES -->
  <section class="categories-section">
    <h2 class="fade-in">Top Categories üëá</h2>
   
    <div class="categories-grid" id="categoriesGrid" style="pointer-events: none;"> 

      <!-- FREE CATEGORIES -->
      <div class="category-card" data-category="population" data-display="Population" data-emoji="üë•"
         style="background-image:url('images/categories/population.jpg');">
        <div class="category-info">
          <span class="emoji">üë•</span>
          <h3>Population</h3>
        </div>
      </div>

      <div class="category-card" data-category="gdp" data-display="GDP Per Capita" data-emoji="üíµ"
         style="background-image:url('images/categories/gdp.jpg');">
        <div class="category-info">
          <span class="emoji">üíµ</span>
          <h3>GDP Per Capita</h3>
        </div>
      </div>

      <div class="category-card" data-category="altitude" data-display="Highest Altitude" data-emoji="üèîÔ∏è"
         style="background-image:url('images/categories/altitude.jpg');">
        <div class="category-info">
          <span class="emoji">üèîÔ∏è</span>
          <h3>Highest Altitude</h3>
        </div>
      </div>

      <div class="category-card" data-category="forest" data-display="Forest Cover" data-emoji="üå≤"
         style="background-image:url('images/categories/forest.jpg');">
        <div class="category-info">
          <span class="emoji">üå≤</span>
          <h3>Forest Cover</h3>
        </div>
      </div>

      <!-- PREMIUM CATEGORIES -->
      <div class="category-card" data-premium="true" data-category="olympic" data-display="Olympic Medals" data-emoji="ü•á"
         style="background-image:url('images/categories/olympic.jpg');">
        <div class="category-info">
          <span class="emoji">ü•á</span>
          <h3>Olympic Medals</h3>
        </div>
      </div>

      <div class="category-card" data-premium="true" data-category="landmass" data-display="Land Mass" data-emoji="üåç"
         style="background-image:url('images/categories/landmass.jpg');">
        <div class="category-info">
          <span class="emoji">üåç</span>
          <h3>Land Mass</h3>
        </div>
      </div>

      <div class="category-card" data-premium="true" data-category="passport" data-display="Passport Strength" data-emoji="üõÇ"
         style="background-image:url('images/categories/passport.jpg');">
        <div class="category-info">
          <span class="emoji">üõÇ</span>
          <h3>Passport Strength</h3>
        </div>
      </div>

      <div class="category-card" data-premium="true" data-category="beer" data-display="Beer Consumption" data-emoji="üç∫"
         style="background-image:url('images/categories/beer.jpg');">
        <div class="category-info">
          <span class="emoji">üç∫</span>
          <h3>Beer Consumption</h3>
        </div>
      </div>

    </div>
  </section>

  <div class="footer-buttons">
    <button id="unlockCategoriesBtn" class="upgrade-access-btn">üîì Unlock All Categories</button>
    <button id="viewCategoriesBtn">View All Categories</button>
  </div>

  <footer class="home-footer">
    <div class="footer-socials">
      <div class="icon-row">
        <a href="https://www.instagram.com/geo_ranks/" target="_blank" rel="noopener">
          <img src="assets/instagram.png" alt="Instagram" />
        </a>
        <div class="divider"></div>
        <a href="https://www.tiktok.com/@georanks" target="_blank" rel="noopener">
          <img src="assets/tik-tok.png" alt="TikTok" />
        </a>
        <div class="divider"></div>
        <a href="https://www.youtube.com/channel/UC8jrsBpCn09u0mHQle_O3Rw" target="_blank" rel="noopener">
          <img src="assets/youtube.png" alt="YouTube" />
        </a>
        <div class="divider"></div>
        <a href="https://x.com/Kieroncroo66687" target="_blank" rel="noopener">
          <img src="assets/x.png" alt="X" />
        </a>
      </div>
      <p>¬© 2025 GeoRanks</p>
    </div>
  </footer>

</div>

<!-- ============================= -->
<!-- ========== SCRIPTS ========== -->
<!-- ============================= -->

<script type="module">
  import { supabase } from './js/supabase-client.js';

  (async () => {
    console.log('--- BEGIN SESSION DEBUG ---');
    const { data: { session }, error } = await supabase.auth.getSession();
    console.log('Session object:', session);
    if (error) console.error('Session error:', error);

    if (!session) {
      console.log('üîí No session: showing locked categories');
      document.querySelectorAll('.category-card.locked').forEach(el => el.classList.remove('hidden'));
      document.getElementById('sign-in-btn')?.addEventListener('click', () => {
        document.getElementById('login-modal')?.classList.remove('hidden');
      });
    } else {
      console.log('‚úÖ Session found: unlock logic can go here');
    }

    console.log('LocalStorage keys:', Object.keys(localStorage));
    if (navigator.storage?.estimate) {
      const estimate = await navigator.storage.estimate();
      console.log('Storage estimate:', estimate);
    }
    console.log('--- END SESSION DEBUG ---');
  })();
</script>

<!-- DAILY CHALLENGE SCRIPT -->
<script type="module">
  import { 
    getTodaysDailyChallenge,
    modeDisplayNames,
    categoryDisplayNames,
    categoryEmojis
  } from './js/daily-challenge.js';

  // Get today's challenge (mode + category)
  const todaysChallenge = getTodaysDailyChallenge();
  console.log('Today\'s Daily Challenge:', todaysChallenge);

  // Update daily challenge card
  const dailyCard = document.getElementById("dailyChallengeCard");
  const dailyTitle = document.getElementById("dailyChallengeTitle");
  const dailyBtn = document.getElementById("dailyChallengeBtn");

  // Calculate display text
  const modeText = modeDisplayNames[todaysChallenge.mode].toUpperCase();
  const categoryText = categoryDisplayNames[todaysChallenge.category].toUpperCase();
  const emoji = categoryEmojis[todaysChallenge.category];

  if (dailyTitle && dailyBtn) {
    // Display: "MODE: CATEGORY" (e.g., "VS MODE: LANDMASS üó∫Ô∏è")
    dailyTitle.textContent = `${modeText}: ${categoryText} ${emoji}`;
    
    // Redirect to new daily challenge page (handles mode selection)
    dailyBtn.href = `daily-challenge.html`;
  }

  // Set background image based on category
  if (dailyCard) {
    const bgMap = {
      population: "population.jpg",
      gdp: "gdp.jpg",
      altitude: "altitude.jpg",
      forest: "forest.jpg",
      coastline: "coastline.jpg",
      olympic: "olympic.jpg",
      landmass: "landmass.jpg",
      passport: "passport.jpg",
      beer: "beer.jpg",
      nobelprize: "nobelprize.jpg",
      worldcup: "worldcup.jpg",
      temperature: "hightemp.jpg",
      precipitation: "rainfall.jpg",
      crimerate: "crimerate.jpg",
      happiness: "happiness.jpg",
      cuisine: "cuisine.jpg"
    };

    const img = bgMap[todaysChallenge.category];
    if (img) {
      dailyCard.style.backgroundImage = `url('images/categories/${img}')`;
      dailyCard.classList.add("has-photo");
    }
  }

  console.log(`üìÖ Today's Daily Challenge: ${modeText} - ${categoryText}`);
</script>

<!-- LOCKED CATEGORY LOGIC -->
<script type="module">
  import { supabase } from './js/supabase-client.js';
  const { data: { session } } = await supabase.auth.getSession();

  let isPremium = false;

  if (session) {
    const { data: profile } = await supabase
      .from("users")
      .select("is_premium")
      .eq("id", session.user.id)
      .single();
    isPremium = profile?.is_premium === true;
  }

  const premiumCards = document.querySelectorAll("[data-premium='true']");

  if (!isPremium) {
    premiumCards.forEach(card => {
      card.classList.add("locked");

      // Add golden lock
      let lock = document.createElement("div");
      lock.className = "lock-icon";
      lock.textContent = "üîí";
      card.appendChild(lock);

      // On click: login check ‚Üí open upgrade modal
      card.addEventListener("click", async (e) => {
        e.preventDefault();

        const { data: { session: innerSession } } = await supabase.auth.getSession();

        if (!innerSession) {
          // NOT signed in ‚Üí still show upgrade modal
          const modal = document.getElementById("premiumModal");
          if (modal) {
            modal.classList.remove("hidden");
            modal.scrollIntoView({ behavior: "smooth", block: "center" });
          } else {
            window.location.href = "premium.html";
          }
          return;
        }

        // Signed in but NOT premium
        const modal = document.getElementById("premiumModal");
        if (modal) {
          modal.classList.remove("hidden");
          modal.scrollIntoView({ behavior: "smooth", block: "center" });
        } else {
          window.location.href = "premium.html";
        }
      });
    });
  }

  // Handle footer buttons
  const viewBtn = document.getElementById("viewCategoriesBtn");
  const unlockBtn = document.getElementById("unlockCategoriesBtn");

  if (viewBtn) {
    viewBtn.onclick = () => window.location.href = "categories.html";
  }
  
  if (unlockBtn) {
    unlockBtn.onclick = () => window.location.href = "premium.html";
  }

  // Hide unlock button for premium users
  if (isPremium && unlockBtn) {
    unlockBtn.remove();
    const footerButtons = document.querySelector(".footer-buttons");
    if (footerButtons) {
      footerButtons.style.justifyContent = "center";
    }
  }
  
  // Enable category grid after premium check is complete
  const categoriesGrid = document.getElementById('categoriesGrid');
  if (categoriesGrid) {
    categoriesGrid.style.pointerEvents = 'auto';
    categoriesGrid.style.opacity = '1';
  }

  // Premium modal button handlers
  const closePremiumBtn = document.getElementById("closePremiumBtn");
  const goPremiumBtn = document.getElementById("goPremiumBtn");
  
  if (closePremiumBtn) {
    closePremiumBtn.onclick = () => {
      const modal = document.getElementById("premiumModal");
      if (modal) modal.classList.add("hidden");
    };
  }
  
  if (goPremiumBtn) {
    goPremiumBtn.onclick = () => {
      window.location.href = "premium.html";
    };
  }
</script>

<!-- PREMIUM MODAL BUTTONS -->
<script type="module">
  import { supabase } from './js/supabase-client.js';

  const { data: { session } } = await supabase.auth.getSession();
  const signInText = document.getElementById("signInText");

  if (!session || !session.user) {
    if (signInText) {
      signInText.innerHTML = `
        <span style="color: inherit;">Sign In</span>
        <span class="divider" style="margin: 0 8px; width: 1px; height: 16px; background: #aaa; display: inline-block; vertical-align: middle;"></span>
        <span style="color: inherit;">Create Account</span>
      `;
      signInText.href = "auth.html";
    }
  } else {
    // User is logged in - try to get username from database first
    const { data: profile } = await supabase
      .from('users')
      .select('username, is_premium')
      .eq('id', session.user.id)
      .single();

    let displayName = null;

    if (profile?.username) {
      // Username found in database
      displayName = profile.username;
    } else if (session.user.user_metadata?.username) {
      // Fallback to username from auth metadata (for newly confirmed users)
      displayName = session.user.user_metadata.username;
      
      // Trigger a database insert if user doesn't exist yet (backup)
      setTimeout(async () => {
        const { error } = await supabase
          .from('users')
          .insert({
            id: session.user.id,
            username: session.user.user_metadata.username,
            email: session.user.email,
            avatar_url: 'assets/profile-icon.jpg',
            is_premium: false
          })
          .select()
          .single();
        
        if (error && error.code !== '23505') { // Ignore duplicate key errors
          console.error('Error creating user profile:', error);
        }
      }, 100);
    } else {
      // Last fallback - use email prefix
      displayName = session.user.email.split('@')[0];
    }

    if (signInText && displayName) {
      signInText.textContent = displayName;
      signInText.href = "account.html";
    }

    // Hide upgrade button for premium users
    if (profile?.is_premium) {
      document.querySelectorAll('.upgrade-access-btn').forEach(btn => btn.remove());
    }
  }
</script>

<!-- Hamburger Menu Logic -->
<script>
const toggleBtn = document.getElementById("menuToggle");
const overlay = document.getElementById("menuOverlay");
const closeBtn = document.getElementById("closeMenu");

toggleBtn?.addEventListener("click", () => overlay.classList.add("active"));
closeBtn?.addEventListener("click", () => overlay.classList.remove("active"));

overlay.addEventListener("click", (e) => {
  if (e.target === overlay) overlay.classList.remove("active");
});
</script>

<!-- ‚ùÑÔ∏è CHRISTMAS SNOW EFFECT ‚ùÑÔ∏è -->
<style>
  /* Snow Canvas */
  #snowCanvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9998;
  }

  /* Settled snow on elements */
  .snow-pile {
    position: absolute;
    bottom: 100%;
    left: 0;
    right: 0;
    height: 0;
    background: linear-gradient(to bottom, 
      rgba(255, 255, 255, 0.95) 0%, 
      rgba(240, 248, 255, 0.9) 50%,
      rgba(255, 255, 255, 0.7) 100%);
    border-radius: 50% 50% 0 0 / 100% 100% 0 0;
    pointer-events: none;
    z-index: 100;
    transition: height 0.3s ease;
    box-shadow: 0 -2px 8px rgba(255, 255, 255, 0.5);
  }

  /* Add subtle snow glow to cards */
  .category-card.snow-touched,
  .daily-challenge-card.snow-touched {
    box-shadow: 0 6px 14px rgba(0, 0, 0, 0.25), 
                0 0 20px rgba(255, 255, 255, 0.3);
  }

  /* Christmas accent colors for header */
  .home-glass-header {
    background: rgba(255, 255, 255, 0.65);
    border-bottom: 2px solid rgba(200, 30, 30, 0.15);
  }

  /* Subtle festive glow on daily challenge */
  .daily-challenge-card {
    border: 2px solid rgba(255, 255, 255, 0.4);
  }

  /* Snowflake sparkle effect */
  @keyframes sparkle {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }
</style>

<canvas id="snowCanvas"></canvas>

<script>
(function() {
  const canvas = document.getElementById('snowCanvas');
  const ctx = canvas.getContext('2d');
  
  // Configuration
  const config = {
    snowflakeCount: 150,
    minSize: 2,
    maxSize: 6,
    minSpeed: 0.5,
    maxSpeed: 2,
    wind: 0.3,
    windVariation: 0.5,
    maxSnowPileHeight: 12,
    meltRate: 0.02,
    settleProbability: 0.7
  };

  let snowflakes = [];
  let obstacles = [];
  let animationId;
  let lastTime = 0;

  // Resize canvas
  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    updateObstacles();
  }

  // Get elements that snow can land on
  function updateObstacles() {
    obstacles = [];
    
    // Category cards
    document.querySelectorAll('.category-card').forEach(card => {
      const rect = card.getBoundingClientRect();
      obstacles.push({
        element: card,
        x: rect.left,
        y: rect.top,
        width: rect.width,
        height: rect.height,
        snowPile: 0,
        type: 'card'
      });
    });

    // Daily challenge card
    const dailyCard = document.querySelector('.daily-challenge-card');
    if (dailyCard) {
      const rect = dailyCard.getBoundingClientRect();
      obstacles.push({
        element: dailyCard,
        x: rect.left,
        y: rect.top,
        width: rect.width,
        height: rect.height,
        snowPile: 0,
        type: 'daily'
      });
    }

    // Glass header
    const header = document.querySelector('.home-glass-header');
    if (header) {
      const rect = header.getBoundingClientRect();
      obstacles.push({
        element: header,
        x: rect.left,
        y: rect.top,
        width: rect.width,
        height: rect.height,
        snowPile: 0,
        type: 'header'
      });
    }
  }

  // Create a snowflake
  function createSnowflake(startFromTop = true) {
    const size = Math.random() * (config.maxSize - config.minSize) + config.minSize;
    return {
      x: Math.random() * canvas.width,
      y: startFromTop ? -10 : Math.random() * canvas.height,
      size: size,
      speed: (Math.random() * (config.maxSpeed - config.minSpeed) + config.minSpeed) * (size / config.maxSize),
      wind: (Math.random() - 0.5) * config.windVariation,
      opacity: Math.random() * 0.5 + 0.5,
      wobble: Math.random() * Math.PI * 2,
      wobbleSpeed: Math.random() * 0.02 + 0.01,
      rotation: Math.random() * Math.PI * 2,
      rotationSpeed: (Math.random() - 0.5) * 0.02
    };
  }

  // Initialize snowflakes
  function initSnowflakes() {
    snowflakes = [];
    for (let i = 0; i < config.snowflakeCount; i++) {
      snowflakes.push(createSnowflake(false));
    }
  }

  // Draw a snowflake
  function drawSnowflake(flake) {
    ctx.save();
    ctx.translate(flake.x, flake.y);
    ctx.rotate(flake.rotation);
    
    // Create gradient for 3D effect
    const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, flake.size);
    gradient.addColorStop(0, `rgba(255, 255, 255, ${flake.opacity})`);
    gradient.addColorStop(0.5, `rgba(240, 248, 255, ${flake.opacity * 0.8})`);
    gradient.addColorStop(1, `rgba(255, 255, 255, 0)`);
    
    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.arc(0, 0, flake.size, 0, Math.PI * 2);
    ctx.fill();
    
    // Add sparkle effect for larger flakes
    if (flake.size > 4) {
      ctx.strokeStyle = `rgba(255, 255, 255, ${flake.opacity * 0.5})`;
      ctx.lineWidth = 0.5;
      for (let i = 0; i < 6; i++) {
        const angle = (Math.PI / 3) * i;
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(Math.cos(angle) * flake.size * 1.5, Math.sin(angle) * flake.size * 1.5);
        ctx.stroke();
      }
    }
    
    ctx.restore();
  }

  // Update snow piles on elements
  function updateSnowPiles() {
    obstacles.forEach(obs => {
      // Ensure element has snow pile div
      if (!obs.pileElement) {
        const pile = document.createElement('div');
        pile.className = 'snow-pile';
        obs.element.style.position = 'relative';
        obs.element.appendChild(pile);
        obs.pileElement = pile;
        obs.element.classList.add('snow-touched');
      }
      
      // Slowly melt snow
      if (obs.snowPile > 0) {
        obs.snowPile = Math.max(0, obs.snowPile - config.meltRate);
      }
      
      // Update pile height
      obs.pileElement.style.height = `${obs.snowPile}px`;
    });
  }

  // Check collision with obstacles
  function checkCollision(flake) {
    for (const obs of obstacles) {
      const rect = obs.element.getBoundingClientRect();
      obs.x = rect.left;
      obs.y = rect.top;
      obs.width = rect.width;
      obs.height = rect.height;

      // Check if snowflake hits top of obstacle
      const snowTop = obs.y - obs.snowPile;
      if (flake.x >= obs.x && 
          flake.x <= obs.x + obs.width &&
          flake.y >= snowTop - flake.size &&
          flake.y <= snowTop + 5) {
        
        // Add to snow pile with probability
        if (Math.random() < config.settleProbability && obs.snowPile < config.maxSnowPileHeight) {
          obs.snowPile += flake.size * 0.15;
        }
        return true;
      }
    }
    return false;
  }

  // Update snowflakes
  function updateSnowflakes(deltaTime) {
    const timeScale = deltaTime / 16.67; // Normalize to 60fps
    
    snowflakes.forEach((flake, index) => {
      // Update position
      flake.wobble += flake.wobbleSpeed * timeScale;
      flake.rotation += flake.rotationSpeed * timeScale;
      
      flake.x += (config.wind + flake.wind + Math.sin(flake.wobble) * 0.5) * timeScale;
      flake.y += flake.speed * timeScale;
      
      // Check collision
      if (checkCollision(flake)) {
        // Reset snowflake at top
        snowflakes[index] = createSnowflake(true);
        return;
      }
      
      // Wrap horizontally
      if (flake.x < -10) flake.x = canvas.width + 10;
      if (flake.x > canvas.width + 10) flake.x = -10;
      
      // Reset if below screen
      if (flake.y > canvas.height + 10) {
        snowflakes[index] = createSnowflake(true);
      }
    });
  }

  // Animation loop
  function animate(currentTime) {
    const deltaTime = currentTime - lastTime;
    lastTime = currentTime;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    updateSnowflakes(deltaTime);
    updateSnowPiles();
    
    snowflakes.forEach(drawSnowflake);
    
    animationId = requestAnimationFrame(animate);
  }

  // Initialize
  function init() {
    resizeCanvas();
    initSnowflakes();
    
    // Start animation
    lastTime = performance.now();
    animate(lastTime);
    
    // Handle resize
    window.addEventListener('resize', () => {
      resizeCanvas();
    });
    
    // Update obstacles on scroll
    window.addEventListener('scroll', updateObstacles);
    
    // Periodic obstacle update for dynamic content
    setInterval(updateObstacles, 1000);
  }

  // Start when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>

<!-- Menu Account Visibility Logic -->
<script type="module">
  import { supabase } from './js/supabase-client.js';

  const { data: { session } } = await supabase.auth.getSession();

  // Hide Account if user not logged in
  if (!session || !session.user) {
    document.querySelectorAll('.menu-btn-account').forEach(btn => btn.remove());
  }
</script>

<!-- Mode Selector Modal Integration -->
<script type="module">
  import { openModeSelector } from './js/mode-selector.js';
  
  // Make openModeSelector globally accessible
  window.openModeSelector = openModeSelector;

  // Add click handlers to all category cards
  document.addEventListener('DOMContentLoaded', () => {
    const categoryCards = document.querySelectorAll('.category-card');
    
    categoryCards.forEach(card => {
      card.addEventListener('click', (e) => {
        // Don't open modal if card is locked (premium)
        if (card.classList.contains('locked')) {
          return; // Let the existing lock modal handle it
        }

        const category = card.dataset.category;
        const displayName = card.dataset.display;
        const emoji = card.dataset.emoji;

        // Open mode selector modal
        openModeSelector(category, displayName, emoji);
      });

      // Add cursor pointer style
      if (!card.classList.contains('locked')) {
        card.style.cursor = 'pointer';
      }
    });
  });
</script>

</body>
</html>