<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GeoRanks â€” Global Ranking Challenge ğŸŒ</title>
  <link rel="icon" href="assets/favicon.png" type="image/png">

  <!-- Fonts and Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/game-modes.css" />
  <link rel="stylesheet" href="css/home.css" />
</head>

<body>

<!-- ========== AUTH MODAL ========== -->
<div class="auth-modal hidden" id="authModal">
  <div class="modal-window">
    <button class="close-auth-modal" id="closeAuthModal">Ã—</button>
    <h2 id="authModalTitle">Sign In</h2>

    <input type="text" id="authUsername" placeholder="Username" style="display:none;" />
    <input type="email" id="authEmail" placeholder="Email address" />
    <input type="password" id="authPassword" placeholder="Password" />

    <div id="forgotPasswordLink" style="margin-top: 0.75rem; text-align: center;">
      <a href="#" style="font-size: 0.9rem; text-decoration: underline; color: #0d315a;">Forgot Password?</a>
    </div>

    <button class="btn-auth" id="authSubmit">Continue</button>

    <div class="toggle-view" id="toggleAuthView">
      Donâ€™t have an account? <span id="toggleAuthLink">Sign Up</span>
    </div>
  </div>
</div>

<!-- ğŸ”’ PREMIUM UPGRADE MODAL -->
<div id="premiumModal" class="premium-modal hidden">
  <div class="premium-window">
    <h2>Premium Feature <span class="lock">ğŸ”’</span></h2>
    <p>These categories are only available with <strong>GeoRanks Premium</strong>.</p>

    <button id="goPremiumBtn" class="premium-btn upgrade">Upgrade to Premium</button>
    <button id="closePremiumBtn" class="premium-btn cancel">Return Home</button>
  </div>
</div>

<script>
document.getElementById("closePremiumBtn").onclick = () => {
  const modal = document.getElementById("premiumModal");
  if (modal) modal.classList.add("hidden");
};

document.getElementById("goPremiumBtn").onclick = () => {
  window.location.href = "premium.html";
};
</script>


<!-- ========== HEADER ========== -->
<header class="home-glass-header">
  <div class="sign-in-text" id="signInText">Sign In</div>
  <div class="hamburger-menu">
    <div class="menu-icon" id="menuToggle">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
</header>

<div class="home-wrapper">

  <!-- Main Header -->
  <header class="home-header visible">
    <div class="logo-wrapper">
      <img
        src="assets/logo.png"
        srcset="assets/logo@2x.png 2x, assets/logo@3x.png 3x"
        alt="GeoRanks Logo"
        class="logo"
      />
    </div>
    <p class="tagline">Test Your World Ranking Knowledge! ğŸŒ</p>
  </header>

  <!-- Hamburger Overlay Menu -->
  <div class="menu-overlay" id="menuOverlay">
    <div class="menu-panel">
      <h2>Menu</h2>
      <button class="menu-btn menu-btn-account" onclick="window.location.href='account.html'">ğŸ‘¤ Account</button>
      <button class="menu-btn upgrade-access-btn" onclick="window.location.href='premium.html'">ğŸ”“ Unlock All Categories</button>
      <button class="menu-btn" onclick="window.location.href='leaderboard.html'">ğŸ† Leaderboard</button>
      <button class="menu-btn" onclick="window.location.href='stats.html'">ğŸ“Š My Stats</button>
      <button class="menu-btn">ğŸ’¡ How to Play</button>
      <button class="menu-btn menu-close" id="closeMenu">Close</button>
    </div>
  </div>

  <!-- DAILY CHALLENGE -->
  <section class="daily-challenge-card">
    <div class="daily-info">
      <h2>ğŸ“… DAILY CHALLENGE</h2>
      <h3>Loading...</h3>
      <a href="#" class="btn-primary glow">Play Now</a>
    </div>
  </section>

  <!-- CATEGORIES -->
  <section class="categories-section">
    <h2>Top Categories ğŸ‘‡</h2>

    <div class="categories-grid" id="categoriesGrid" style="pointer-events: none; opacity: 0.6;">

      <!-- FREE CATEGORIES -->
      <a href="game.html?mode=population" class="category-card"
         style="background-image:url('images/categories/population.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ‘¥</span>
          <h3>Population</h3>
        </div>
      </a>

      <a href="game.html?mode=gdp" class="category-card"
         style="background-image:url('images/categories/gdp.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ’µ</span>
          <h3>GDP</h3>
        </div>
      </a>

      <a href="game.html?mode=altitude" class="category-card"
         style="background-image:url('images/categories/altitude.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ”ï¸</span>
          <h3>Highest Altitude</h3>
        </div>
      </a>

      <a href="game.html?mode=forest" class="category-card"
         style="background-image:url('images/categories/forest.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸŒ²</span>
          <h3>Forest Cover</h3>
        </div>
      </a>

      <!-- PREMIUM CATEGORIES -->
      <a href="game.html?mode=olympic" class="category-card" data-premium="true"
         style="background-image:url('images/categories/olympic.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ¥‡</span>
          <h3>Olympic Medals</h3>
        </div>
      </a>

      <a href="game.html?mode=landmass" class="category-card" data-premium="true"
         style="background-image:url('images/categories/landmass.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸŒ</span>
          <h3>Land Mass</h3>
        </div>
      </a>

      <a href="game.html?mode=passport" class="category-card" data-premium="true"
         style="background-image:url('images/categories/passport.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ›‚</span>
          <h3>Passport Strength</h3>
        </div>
      </a>

      <a href="game.html?mode=beer" class="category-card" data-premium="true"
         style="background-image:url('images/categories/beer.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸº</span>
          <h3>Beer Consumption</h3>
        </div>
      </a>

    </div>
  </section>

  <div class="footer-buttons">
  <button id="unlockCategoriesBtn" class="upgrade-access-btn">ğŸ”“ Unlock All Categories</button>
  <button id="viewCategoriesBtn">ğŸ‘ï¸ View All Categories</button>
</div>

  <footer class="home-footer">
    <p>Â© 2025 GeoRanks</p>
  </footer>

</div>

<!-- ============================= -->
<!-- ========== SCRIPTS ========== -->
<!-- ============================= -->

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const SUPABASE_URL = "https://ajwxgdaninuzcpfwawug.supabase.co";
  const SUPABASE_ANON_KEY =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFqd3hnZGFuaW51emNwZndhd3VnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1MDI5ODgsImV4cCI6MjA3NzA3ODk4OH0._LvYsqhSZIsWLIvAYtEceg1fXbEuaM0DElY5poVqZxI";

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  window.supabaseClient = supabase;

  const signInText = document.getElementById("signInText");
  const submitBtn = document.getElementById("authSubmit");
  const authTitle = document.getElementById("authModalTitle");
  const emailInput = document.getElementById("authEmail");
  const passwordInput = document.getElementById("authPassword");
  const usernameInput = document.getElementById("authUsername");
  const toggleAuthView = document.getElementById("toggleAuthView");

  let isSignIn = true;

  function rebindToggleAuthLink() {
    const newToggle = document.getElementById("toggleAuthLink");
    const forgotLink = document.getElementById("forgotPasswordLink");

    newToggle.addEventListener("click", () => {
      isSignIn = !isSignIn;

      if (isSignIn) {
        authTitle.textContent = "Sign In";
        submitBtn.textContent = "Continue";
        passwordInput.placeholder = "Password";
        usernameInput.style.display = "none";
        forgotLink.style.display = "block";
        toggleAuthView.innerHTML =
          'Donâ€™t have an account? <span id="toggleAuthLink">Sign Up</span>';
      } else {
        authTitle.textContent = "Sign Up";
        submitBtn.textContent = "Register";
        passwordInput.placeholder = "Create a password";
        usernameInput.style.display = "block";
        forgotLink.style.display = "none";
        toggleAuthView.innerHTML =
          'Already have an account? <span id="toggleAuthLink">Sign In</span>';
      }

      rebindToggleAuthLink();
    });
  }

  async function handleAuth() {
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();
    const username = usernameInput.value.trim();

    if (!email || !password || (!isSignIn && !username)) {
      return alert("Please fill in all fields");
    }

    if (isSignIn) {
      const { error } = await supabase.auth.signInWithPassword({
        email,
        password,
      });
      if (error) return alert("âŒ " + error.message);
      window.location.reload();
    } 
      else {
      const { data: existing, error: checkError } = await supabase
        .from("users")
        .select("id")
        .eq("username", username)
        .maybeSingle();

      if (checkError) return alert("âŒ " + checkError.message);
      if (existing) return alert("âŒ Username already taken");

      const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: { data: { username } },
      });

      if (error) return alert("âŒ " + error.message);

      alert("âœ… Please check your email to confirm your account.");
    }

    document.getElementById("authModal")?.classList.add("hidden");
  }

  submitBtn.addEventListener("click", handleAuth);
  rebindToggleAuthLink();

  const handleAuthUI = async (session) => {
    if (session?.user) {
      const {
        data: { user },
      } = await supabase.auth.getUser();

      if (user) {
        const { data: profile, error } = await supabase
          .from("users")
          .select("username")
          .eq("id", user.id)
          .single();

        if (error) {
          console.error("âŒ Failed to load user profile:", error.message);
          signInText.textContent = user.email || "Account";
        } else {
          signInText.textContent = profile.username;
        }

        signInText.style.cursor = "pointer";
        signInText.onclick = () => (window.location.href = "account.html");
      }
    } else {
      signInText.textContent = "Sign In";
      signInText.style.cursor = "pointer";
      signInText.onclick = () =>
        document.getElementById("authModal")?.classList.remove("hidden");
    }
  };

  supabase.auth.getSession().then(({ data: { session } }) => {
    handleAuthUI(session);
  });

  supabase.auth.onAuthStateChange((event, session) => {
    handleAuthUI(session);
    if (event === "SIGNED_OUT") {
      window.location.href = "index.html";
    }
  });

  const closeModalBtn = document.getElementById("closeAuthModal");
  closeModalBtn?.addEventListener("click", () =>
    document.getElementById("authModal")?.classList.add("hidden")
  );

  document
    .getElementById("forgotPasswordLink")
    ?.addEventListener("click", async (e) => {
      e.preventDefault();
      const email = emailInput.value.trim();

      if (!email) {
        return alert("Please enter your email to reset your password.");
      }

      const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: "https://www.geo-ranks.com/reset-password.html",
      });

      if (error) {
        alert("âŒ " + error.message);
      } else {
        alert("âœ… Password reset email sent! Please check your inbox.");
        document.getElementById("authModal")?.classList.add("hidden");
      }
    });
</script>

<!-- DAILY CHALLENGE SCRIPT -->
<script>
  const categories = [
    { title: "Population ğŸ‘¥", emoji: "ğŸ‘¥", mode: "population" },
    { title: "GDP ğŸ’µ", emoji: "ğŸ’µ", mode: "gdp" },
    { title: "Happiness â˜ºï¸", emoji: "â˜ºï¸", mode: "happiness" },
    { title: "Forest Cover ğŸŒ²", emoji: "ğŸŒ²", mode: "forest" },
    { title: "Longest Coastline ğŸŒŠ", emoji: "ğŸŒŠ", mode: "coastline" },
    { title: "Cuisine ğŸ½ï¸", emoji: "ğŸ½ï¸", mode: "cuisine" },
    { title: "Olympic Medals ğŸ¥‡", emoji: "ğŸ¥‡", mode: "olympic" },
    { title: "World Cup âš½ï¸", emoji: "âš½ï¸", mode: "worldcup" },
    { title: "Land Mass ğŸŒ", emoji: "ğŸŒ", mode: "landmass" },
    { title: "Altitude ğŸ”ï¸", emoji: "ğŸ”ï¸", mode: "altitude" },
    { title: "Passport ğŸ›‚", emoji: "ğŸ›‚", mode: "passport" },
    { title: "Beer Consumption ğŸº", emoji: "ğŸº", mode: "beer" },
    { title: "Nobel Prize ğŸ•Šï¸", emoji: "ğŸ•Šï¸", mode: "nobelprize" },
    { title: "Rainfall ğŸŒ§ï¸", emoji: "ğŸŒ§ï¸", mode: "precipitation" },
  ];

  const now = new Date();
  const startOfEpoch = new Date(Date.UTC(2025, 0, 1));
  const daysSinceEpoch = Math.floor((now - startOfEpoch) / 86400000);
  const categoryIndex = daysSinceEpoch % categories.length;
  const todayCategory = categories[categoryIndex];

  const dailyCard = document.querySelector(".daily-challenge-card");
  if (dailyCard) {
    dailyCard.querySelector("h3").textContent = `Rank by ${todayCategory.title}`;
    const playButton = dailyCard.querySelector("a");
    playButton.href = `game.html?mode=${todayCategory.mode}`;

    const bgMap = {
      population: "population.jpg",
      gdp: "gdp.jpg",
      happiness: "happiness.jpg",
      forest: "forest.jpg",
      coastline: "coastline.jpg",
      cuisine: "cuisine.jpg",
      olympic: "olympic.jpg",
      worldcup: "worldcup.jpg",
      landmass: "landmass.jpg",
      altitude: "altitude.jpg",
      passport: "passport.jpg",
      beer: "beer.jpg",
      nobelprize: "nobelprize.jpg",
      temperature: "hightemp.jpg",
      precipitation: "rainfall.jpg",
    };

    const img = bgMap[todayCategory.mode];
    if (img) {
      dailyCard.style.backgroundImage = `url('images/categories/${img}')`;
      dailyCard.classList.add("has-photo");
    }
  }
</script>

<!-- LOCKED CATEGORY LOGIC -->
<script type="module">
  // @ts-ignore
  const supabase = window.supabaseClient;

  const { data: { session } } = await supabase.auth.getSession();

  let isPremium = false;

  if (session) {
    const { data: profile } = await supabase
      .from("users")
      .select("is_premium")
      .eq("id", session.user.id)
      .single();
    isPremium = profile?.is_premium === true;
  }

  const premiumCards = document.querySelectorAll("[data-premium='true']");

  if (!isPremium) {
    premiumCards.forEach(card => {
      card.classList.add("locked");

      // Add golden lock
      let lock = document.createElement("div");
      lock.className = "lock-icon";
      lock.textContent = "ğŸ”’";
      card.appendChild(lock);

      // On click: login check â†’ open upgrade modal
      card.addEventListener("click", async (e) => {
        e.preventDefault();

        const { data: { session: innerSession } } = await supabase.auth.getSession();

        if (!innerSession) {
          // NOT signed in â†’ still show upgrade modal
          const modal = document.getElementById("premiumModal");
          if (modal) {
            modal.classList.remove("hidden");
            modal.scrollIntoView({ behavior: "smooth", block: "center" });
          } else {
            window.location.href = "premium.html";
          }
          return;
        }

        // Signed in but NOT premium
        const modal = document.getElementById("premiumModal");
        if (modal) {
          modal.classList.remove("hidden");
          modal.scrollIntoView({ behavior: "smooth", block: "center" });
        } else {
          window.location.href = "premium.html";
        }
      });
    });
  }

  // Handle footer buttons
  const viewBtn = document.getElementById("viewCategoriesBtn");
  const unlockBtn = document.getElementById("unlockCategoriesBtn");

  viewBtn.onclick = () => window.location.href = "categories.html";
  unlockBtn.onclick = () => window.location.href = "premium.html";

  // Hide unlock button for premium users
  if (isPremium) {
    unlockBtn?.remove();
    document.querySelector(".footer-buttons").style.justifyContent = "center";
  }
  
  // Enable category grid after premium check is complete
  const categoriesGrid = document.getElementById('categoriesGrid');
  if (categoriesGrid) {
    categoriesGrid.style.pointerEvents = 'auto';
    categoriesGrid.style.opacity = '1';
  }
</script>


<!-- PREMIUM MODAL BUTTONS -->
<script>
  document.getElementById("closePremiumBtn").onclick = () => {
    const modal = document.getElementById("premiumModal");
    if (modal) modal.classList.add("hidden");
  };

  document.getElementById("goPremiumBtn").onclick = () => {
    window.location.href = "premium.html";
  };
</script>


<!-- Hamburger Menu Logic -->
<script>
const toggleBtn = document.getElementById("menuToggle");
const overlay = document.getElementById("menuOverlay");
const closeBtn = document.getElementById("closeMenu");

toggleBtn?.addEventListener("click", () => overlay.classList.add("active"));
closeBtn?.addEventListener("click", () => overlay.classList.remove("active"));

overlay.addEventListener("click", (e) => {
  if (e.target === overlay) overlay.classList.remove("active");
});
</script>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const supabase = createClient(
    'https://ajwxgdaninuzcpfwawug.supabase.co',
    'YOUR_SUPABASE_ANON_KEY'
  );

  const { data: { session } } = await supabase.auth.getSession();

  // Hide Account if user not logged in
  if (!session || !session.user) {
    document.querySelectorAll('.menu-btn-account').forEach(btn => btn.remove());
  }

  // Hide Unlock All Categories if user is premium
  if (session && session.user) {
    const { data: profile } = await supabase
      .from('users')
      .select('is_premium')
      .eq('id', session.user.id)
      .single();

    if (profile?.is_premium) {
      document.querySelectorAll('.upgrade-access-btn').forEach(btn => btn.remove());
    }
  }
</script>


</body>
</html>
