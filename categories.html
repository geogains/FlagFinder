<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Categories - GeoRanks</title>
  <link rel="icon" href="assets/favicon.png" type="image/png">

  <!-- Fonts and Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/game-modes.css" />
  <link rel="stylesheet" href="css/home.css" />
</head>

<body>

<!-- ========== AUTH MODAL ========== -->
<div class="auth-modal hidden" id="authModal">
  <div class="modal-window">
    <button class="close-auth-modal" id="closeAuthModal">Ã—</button>
    <h2 id="authModalTitle">Sign In</h2>

    <input type="text" id="authUsername" placeholder="Username" style="display:none;" />
    <input type="email" id="authEmail" placeholder="Email address" />
    <input type="password" id="authPassword" placeholder="Password" />

    <div id="forgotPasswordLink" style="margin-top: 0.75rem; text-align: center;">
      <a href="#" style="font-size: 0.9rem; text-decoration: underline; color: #0d315a;">Forgot Password?</a>
    </div>

    <button class="btn-auth" id="authSubmit">Continue</button>

    <div class="toggle-view" id="toggleAuthView">
      Don't have an account? <span id="toggleAuthLink">Sign Up</span>
    </div>
  </div>
</div>

<!-- ğŸ”’ PREMIUM UPGRADE MODAL -->
<div id="premiumModal" class="premium-modal hidden">
  <div class="premium-window">
    <h2>Premium Feature <span class="lock">ğŸ”’</span></h2>
    <p>These categories are only available with <strong>GeoRanks Premium</strong>.</p>

    <button id="goPremiumBtn" class="premium-btn upgrade">Upgrade to Premium</button>
    <button id="closePremiumBtn" class="premium-btn cancel">Return Home</button>
  </div>
</div>

<!-- ========== HEADER (Leaderboard Style) ========== -->
<header class="home-glass-header">
  <div class="logo-header">
    <a href="index.html" class="logo-link">
      <img src="assets/logo.png" alt="GeoRanks Logo" />
    </a>
  </div>
  <div class="hamburger-menu">
    <div class="menu-icon" id="menuToggle">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
</header>

<div class="home-wrapper">

  <!-- Hamburger Overlay Menu -->
  <div class="menu-overlay" id="menuOverlay">
    <div class="menu-panel">
      <h2>Menu</h2>
      <button class="menu-btn" onclick="window.location.href='index.html'">ğŸ  Home</button>
      <button class="menu-btn menu-btn-account" onclick="window.location.href='account.html'">ğŸ‘¤ Account</button>
      <button class="menu-btn" onclick="window.location.href='leaderboard.html'">ğŸ† Leaderboard</button>
      <button class="menu-btn" onclick="window.location.href='stats.html'">ğŸ“Š My Stats</button>
      <button class="menu-btn">ğŸ’¡ How to Play</button>
      <button class="menu-btn upgrade-access-btn" onclick="window.location.href='premium.html'">ğŸ”“ Unlock All Categories</button>
      <button class="menu-btn menu-close" id="closeMenu">Close</button>
    </div>
  </div>

  <!-- CATEGORIES -->
  <section class="categories-section">
    <h2>Explore All Categories ğŸ‘‡</h2>

    <div class="categories-grid" id="categoriesGrid" style="pointer-events: none; opacity: 0.6;">

      <!-- FREE CATEGORIES -->
      <a href="game.html?mode=population" class="category-card"
         style="background-image:url('images/categories/population.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ‘¥</span>
          <h3>Population</h3>
        </div>
      </a>

      <a href="game.html?mode=gdp" class="category-card"
         style="background-image:url('images/categories/gdp.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ’µ</span>
          <h3>GDP</h3>
        </div>
      </a>

      <a href="game.html?mode=altitude" class="category-card"
         style="background-image:url('images/categories/altitude.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ”ï¸</span>
          <h3>Highest Altitude</h3>
        </div>
      </a>

      <a href="game.html?mode=forest" class="category-card"
         style="background-image:url('images/categories/forest.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸŒ²</span>
          <h3>Forest Cover</h3>
        </div>
      </a>

      <!-- PREMIUM CATEGORIES -->
   <a href="game.html?mode=coastline" class="category-card" data-premium="true"
         style="background-image:url('images/categories/coastline.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸŒŠ</span>
          <h3>Longest Coastline</h3>
        </div>
      </a>

      <a href="game.html?mode=olympic" class="category-card" data-premium="true"
         style="background-image:url('images/categories/olympic.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ¥‡</span>
          <h3>Olympic Medals</h3>
        </div>
      </a>


      <a href="game.html?mode=cuisine" class="category-card" data-premium="true"
         style="background-image:url('images/categories/cuisine.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ½ï¸</span>
          <h3>Cuisine</h3>
        </div>
      </a>

      <a href="game.html?mode=worldcup" class="category-card" data-premium="true"
         style="background-image:url('images/categories/worldcup.jpg');">
        <div class="category-info">
          <span class="emoji">âš½ï¸</span>
          <h3>World Cup Trophies</h3>
        </div>
      </a>

      <a href="game.html?mode=landmass" class="category-card" data-premium="true"
         style="background-image:url('images/categories/landmass.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸŒ</span>
          <h3>Land Mass</h3>
        </div>
      </a>

      <a href="game.html?mode=crimerate" class="category-card" data-premium="true"
         style="background-image:url('images/categories/crimerate.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸš¨</span>
          <h3>Crime Rate</h3>
        </div>
      </a>

      <a href="game.html?mode=happiness" class="category-card" data-premium="true"
         style="background-image:url('images/categories/happiness.jpg');">
        <div class="category-info">
          <span class="emoji">â˜ºï¸</span>
          <h3>Happiness</h3>
        </div>
      </a>

      <a href="game.html?mode=passport" class="category-card" data-premium="true"
         style="background-image:url('images/categories/passport.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ›‚</span>
          <h3>Passport Strength</h3>
        </div>
      </a>

      <a href="game.html?mode=beer" class="category-card" data-premium="true"
         style="background-image:url('images/categories/beer.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸº</span>
          <h3>Beer Consumption</h3>
        </div>
      </a>

      <a href="game.html?mode=nobelprize" class="category-card" data-premium="true"
         style="background-image:url('images/categories/nobelprize.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ•Šï¸</span>
          <h3>Noble Prize Winners</h3>
        </div>
      </a>

      <a href="game.html?mode=temperature" class="category-card" data-premium="true"
         style="background-image:url('images/categories/hightemp.jpg');">
        <div class="category-info">
          <span class="emoji">â˜€ï¸</span>
          <h3>Highest Temperature</h3>
        </div>
      </a>

      <a href="game.html?mode=precipitation" class="category-card" data-premium="true"
         style="background-image:url('images/categories/rainfall.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸŒ§ï¸</span>
          <h3>Rainfall</h3>
        </div>
      </a>

    </div>
  </section>

  <footer class="home-footer">
    <p>Â© 2025 GeoRanks</p>
  </footer>

</div>

<!-- ============================= -->
<!-- ========== SCRIPTS ========== -->
<!-- ============================= -->

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const SUPABASE_URL = "https://ajwxgdaninuzcpfwawug.supabase.co";
  const SUPABASE_ANON_KEY =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFqd3hnZGFuaW51emNwZndhd3VnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1MDI5ODgsImV4cCI6MjA3NzA3ODk4OH0._LvYsqhSZIsWLIvAYtEceg1fXbEuaM0DElY5poVqZxI";

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  window.supabaseClient = supabase;

  // --- AUTH MODAL LOGIC ---
  const submitBtn = document.getElementById("authSubmit");
  const authTitle = document.getElementById("authModalTitle");
  const emailInput = document.getElementById("authEmail");
  const passwordInput = document.getElementById("authPassword");
  const usernameInput = document.getElementById("authUsername");
  const toggleAuthView = document.getElementById("toggleAuthView");
  const closeModalBtn = document.getElementById("closeAuthModal");
  const forgotPasswordLink = document.getElementById("forgotPasswordLink");
  const authModal = document.getElementById("authModal");

  let isSignIn = true;

  function updateAuthModalUI() {
    if (isSignIn) {
      authTitle.textContent = "Sign In";
      submitBtn.textContent = "Continue";
      passwordInput.placeholder = "Password";
      usernameInput.style.display = "none";
      forgotPasswordLink.style.display = "block";
      toggleAuthView.innerHTML =
        "Don't have an account? <span id='toggleAuthLink'>Sign Up</span>";
    } else {
      authTitle.textContent = "Sign Up";
      submitBtn.textContent = "Register";
      passwordInput.placeholder = "Create a password";
      usernameInput.style.display = "block";
      forgotPasswordLink.style.display = "none";
      toggleAuthView.innerHTML =
        "Already have an account? <span id='toggleAuthLink'>Sign In</span>";
    }
    // Rebind the click listener after changing innerHTML
    document.getElementById("toggleAuthLink")?.addEventListener("click", () => {
      isSignIn = !isSignIn;
      updateAuthModalUI();
    });
  }

  async function handleAuth() {
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();
    const username = usernameInput.value.trim();

    if (!email || !password || (!isSignIn && !username)) {
      return alert("Please fill in all fields");
    }

    if (isSignIn) {
      const { error } = await supabase.auth.signInWithPassword({
        email,
        password,
      });
      if (error) return alert("âŒ " + error.message);
      window.location.reload();
    } else {
      const { data: existing, error: checkError } = await supabase
        .from("users")
        .select("id")
        .eq("username", username)
        .maybeSingle();

      if (checkError) return alert("âŒ " + checkError.message);
      if (existing) return alert("âŒ Username already taken");

      const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: { data: { username } },
      });

      if (error) return alert("âŒ " + error.message);

      alert("âœ… Please check your email to confirm your account.");
    }

    authModal?.classList.add("hidden");
  }

  if (submitBtn) {
    submitBtn.addEventListener("click", handleAuth);
    updateAuthModalUI(); // Initial setup
  }

  closeModalBtn?.addEventListener("click", () => authModal?.classList.add("hidden"));

  forgotPasswordLink?.addEventListener("click", async (e) => {
    e.preventDefault();
    const email = emailInput.value.trim();

    if (!email) {
      return alert("Please enter your email to reset your password.");
    }

    const { error } = await supabase.auth.resetPasswordForEmail(email, {
      redirectTo: "https://www.geo-ranks.com/reset-password.html",
    });

    if (error) {
      alert("âŒ " + error.message);
    } else {
      alert("âœ… Password reset email sent! Please check your inbox.");
      authModal?.classList.add("hidden");
    }
  });

  // --- AUTH UI & MENU LOGIC ---
  const handleAuthUI = async (session) => {
    const accountBtns = document.querySelectorAll('.menu-btn-account');
    const upgradeBtns = document.querySelectorAll('.upgrade-access-btn');

    let isPremium = false;

    if (session?.user) {
      const { data: profile } = await supabase
        .from("users")
        .select("is_premium")
        .eq("id", session.user.id)
        .single();

      if (profile) {
        isPremium = profile.is_premium === true;
      }

      // Show Account button in menu
      accountBtns.forEach(btn => btn.style.display = "block");

      // Hide Upgrade buttons for premium users
      if (isPremium) {
        upgradeBtns.forEach(btn => btn.remove());
      }
    } else {
      // User is NOT signed in
      // Hide Account button in menu
      accountBtns.forEach(btn => btn.remove());
    }
    return isPremium;
  };

  // --- LOCKED CATEGORY LOGIC ---
  async function setupLockedCategories(isPremium) {
    const premiumCards = document.querySelectorAll("[data-premium='true']");

    if (!isPremium) {
      premiumCards.forEach(card => {
        card.classList.add("locked");

        // Add golden lock
        let lock = document.createElement("div");
        lock.className = "lock-icon";
        lock.textContent = "ğŸ”’";
        card.appendChild(lock);

        // On click: open upgrade modal
        card.addEventListener("click", async (e) => {
          e.preventDefault();

          const { data: { session: innerSession } } = await supabase.auth.getSession();

          if (!innerSession) {
            // NOT signed in â†’ open auth modal
            document.getElementById("authModal")?.classList.remove("hidden");
            return;
          }

          // Signed in but NOT premium â†’ open premium modal
          const modal = document.getElementById("premiumModal");
          if (modal) {
            modal.classList.remove("hidden");
            modal.scrollIntoView({ behavior: "smooth", block: "center" });
          } else {
            window.location.href = "premium.html";
          }
        });
      });
    }

    // Enable category grid after premium check is complete
    const categoriesGrid = document.getElementById('categoriesGrid');
    if (categoriesGrid) {
      categoriesGrid.style.pointerEvents = 'auto';
      categoriesGrid.style.opacity = '1';
    }
  }

  // --- PREMIUM MODAL BUTTONS ---
  document.getElementById("closePremiumBtn")?.addEventListener('click', () => {
    document.getElementById("premiumModal")?.classList.add("hidden");
  });

  document.getElementById("goPremiumBtn")?.addEventListener('click', () => {
    window.location.href = "premium.html";
  });

  // --- HAMBURGER MENU LOGIC ---
  const toggleBtn = document.getElementById("menuToggle");
  const overlay = document.getElementById("menuOverlay");
  const closeMenuBtn = document.getElementById("closeMenu");

  toggleBtn?.addEventListener("click", () => overlay.classList.add("active"));
  closeMenuBtn?.addEventListener("click", () => overlay.classList.remove("active"));

  overlay.addEventListener("click", (e) => {
    if (e.target === overlay) overlay.classList.remove("active");
  });

  // --- INITIALIZATION ---
  document.addEventListener("DOMContentLoaded", async () => {
    // Handle initial session check and state change listener
    const { data: { session } } = await supabase.auth.getSession();
    const isPremium = await handleAuthUI(session);
    setupLockedCategories(isPremium);

    supabase.auth.onAuthStateChange(async (event, session) => {
      const isPremium = await handleAuthUI(session);
      setupLockedCategories(isPremium);
      if (event === "SIGNED_OUT" && window.location.pathname.includes("account.html")) {
        window.location.href = "index.html";
      }
    });
  });
</script>

</body>
</html>