<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Categories - GeoRanks</title>
  <link rel="icon" href="assets/favicon.png" type="image/png">

  <!-- Fonts and Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/game-modes.css" />
  <link rel="stylesheet" href="css/home.css" />
  <link rel="stylesheet" href="css/mode-selector.css" />
</head>

<body>

<!-- ğŸ”’ PREMIUM UPGRADE MODAL -->
<div id="premiumModal" class="premium-modal hidden">
  <div class="premium-window">
    <h2>Premium Feature <span class="lock">ğŸ”’</span></h2>
    <p>These categories are only available with <strong>GeoRanks Premium</strong>.</p>

    <button id="goPremiumBtn" class="premium-btn upgrade">Upgrade to Premium</button>
    <button id="closePremiumBtn" class="premium-btn cancel">Return Home</button>
  </div>
</div>

<!-- ========== HEADER (Leaderboard Style) ========== -->
<header class="home-glass-header">
  <div class="logo-header">
    <a href="index.html" class="logo-link">
      <img src="assets/logo.png" alt="GeoRanks Logo" />
    </a>
  </div>
  <div class="hamburger-menu">
    <div class="menu-icon" id="menuToggle">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
</header>

<div class="home-wrapper">

  <!-- Hamburger Overlay Menu -->
  <div class="menu-overlay" id="menuOverlay">
    <div class="menu-panel">
      <h2>Menu</h2>
      <button class="menu-btn" onclick="window.location.href='index.html'">ğŸ  Home</button>
      <button class="menu-btn menu-btn-account" onclick="window.location.href='account.html'">ğŸ‘¤ Account</button>
      <button class="menu-btn" onclick="window.location.href='leaderboard.html'">ğŸ† Leaderboard</button>
      <button class="menu-btn" onclick="window.location.href='stats.html'">ğŸ“Š My Stats</button>
      <button class="menu-btn" onclick="window.location.href='how-to-play.html'">ğŸ’¡ How to Play</button>
      <button class="menu-btn" onclick="location.href='feedback.html'">ğŸ’¬ Feedback</button>
      <button class="menu-btn" onclick="location.href='contact.html'">ğŸ“© Contact Us</button>
      <button class="menu-btn upgrade-access-btn" onclick="window.location.href='premium.html'">ğŸ”“ Unlock All Categories</button>
      <button class="menu-btn menu-close" id="closeMenu">Close</button>
    </div>
  </div>

  <!-- CATEGORIES -->
  <section class="categories-section">
    <h2>Explore All Categories ğŸ‘‡</h2>
    <!-- ğŸ” Advanced Search Bar -->
<div class="search-bar-wrapper">
  <input type="text" id="categorySearchInput" placeholder="ğŸ” Search Categories..." readonly />
</div>

    <div class="categories-grid" id="categoriesGrid" style="pointer-events: none; opacity: 0.6;">

      <!-- FREE CATEGORIES -->
      <div class="category-card" data-category="population" data-display="Population" data-emoji="ğŸ‘¥"
         style="background-image:url('images/categories/population.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ‘¥</span>
          <h3>Population</h3>
        </div>
      </div>

      <div class="category-card" data-category="gdp" data-display="GDP Per Capita" data-emoji="ğŸ’µ"
         style="background-image:url('images/categories/gdp.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ’µ</span>
          <h3>GDP Per Capita</h3>
        </div>
      </div>

      <div class="category-card" data-category="altitude" data-display="Highest Altitude" data-emoji="ğŸ”ï¸"
         style="background-image:url('images/categories/altitude.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ”ï¸</span>
          <h3>Highest Altitude</h3>
        </div>
      </div>

      <div class="category-card" data-category="forest" data-display="Forest Cover" data-emoji="ğŸŒ²"
         style="background-image:url('images/categories/forest.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸŒ²</span>
          <h3>Forest Cover</h3>
        </div>
      </div>

      <!-- PREMIUM CATEGORIES -->
   <div class="category-card" data-premium="true" data-category="coastline" data-display="Longest Coastline" data-emoji="ğŸŒŠ"
         style="background-image:url('images/categories/coastline.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸŒŠ</span>
          <h3>Longest Coastline</h3>
        </div>
      </div>

      <div class="category-card" data-premium="true" data-category="olympic" data-display="Olympic Medals" data-emoji="ğŸ¥‡"
         style="background-image:url('images/categories/olympic.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ¥‡</span>
          <h3>Olympic Medals</h3>
        </div>
      </div>


      <div class="category-card" data-premium="true" data-category="cuisine" data-display="Cuisine" data-emoji="ğŸ½ï¸"
         style="background-image:url('images/categories/cuisine.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ½ï¸</span>
          <h3>Cuisine</h3>
        </div>
      </div>

      <div class="category-card" data-premium="true" data-category="worldcup" data-display="World Cup Trophies" data-emoji="âš½"
         style="background-image:url('images/categories/worldcup.jpg');">
        <div class="category-info">
          <span class="emoji">âš½ï¸</span>
          <h3>World Cup Trophies</h3>
        </div>
      </div>

      <div class="category-card" data-premium="true" data-category="landmass" data-display="Land Mass" data-emoji="ğŸŒ"
         style="background-image:url('images/categories/landmass.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸŒ</span>
          <h3>Land Mass</h3>
        </div>
      </div>

      <div class="category-card" data-premium="true" data-category="crimerate" data-display="Crime Rate" data-emoji="ğŸš¨"
         style="background-image:url('images/categories/crimerate.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸš¨</span>
          <h3>Crime Rate</h3>
        </div>
      </div>

      <div class="category-card" data-premium="true" data-category="happiness" data-display="Happiness" data-emoji="ğŸ˜Š"
         style="background-image:url('images/categories/happiness.jpg');">
        <div class="category-info">
          <span class="emoji">â˜ºï¸</span>
          <h3>Happiness</h3>
        </div>
      </div>

      <div class="category-card" data-premium="true" data-category="passport" data-display="Passport Strength" data-emoji="ğŸ›‚"
         style="background-image:url('images/categories/passport.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ›‚</span>
          <h3>Passport Strength</h3>
        </div>
      </div>

      <div class="category-card" data-premium="true" data-category="beer" data-display="Beer Consumption" data-emoji="ğŸº"
         style="background-image:url('images/categories/beer.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸº</span>
          <h3>Beer Consumption</h3>
        </div>
      </div>

      <div class="category-card" data-premium="true" data-category="nobelprize" data-display="Nobel Prize Winners" data-emoji="ğŸ†"
         style="background-image:url('images/categories/nobelprize.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸ•Šï¸</span>
          <h3>Noble Prize Winners</h3>
        </div>
      </div>

      <div class="category-card" data-premium="true" data-category="temperature" data-display="Highest Temperature" data-emoji="ğŸŒ¡ï¸"
         style="background-image:url('images/categories/hightemp.jpg');">
        <div class="category-info">
          <span class="emoji">â˜€ï¸</span>
          <h3>Highest Temperature</h3>
        </div>
      </div>

      <div class="category-card" data-premium="true" data-category="precipitation" data-display="Rainfall" data-emoji="ğŸŒ§ï¸"
         style="background-image:url('images/categories/rainfall.jpg');">
        <div class="category-info">
          <span class="emoji">ğŸŒ§ï¸</span>
          <h3>Rainfall</h3>
        </div>
      </div>

    </div>
  </section>

  <footer class="home-footer">
  <div class="footer-socials">
    <div class="icon-row">
      <a href="https://www.instagram.com/geo_ranks/" target="_blank" rel="noopener">
        <img src="assets/instagram.png" alt="Instagram" />
      </a>
      <div class="divider"></div>
      <a href="https://www.tiktok.com/@georanks" target="_blank" rel="noopener">
        <img src="assets/tik-tok.png" alt="TikTok" />
      </a>
      <div class="divider"></div>
      <a href="https://www.youtube.com/channel/UC8jrsBpCn09u0mHQle_O3Rw" target="_blank" rel="noopener">
        <img src="assets/youtube.png" alt="YouTube" />
      </a>
      <div class="divider"></div>
      <a href="https://x.com/Kieroncroo66687" target="_blank" rel="noopener">
        <img src="assets/x.png" alt="X" />
      </a>
    </div>
    <p>Â© 2025 GeoRanks</p>
  </div>
</footer>

</div>

<!-- ============================= -->
<!-- ========== SCRIPTS ========== -->
<!-- ============================= -->

<!-- LOCKED CATEGORY LOGIC -->
<script type="module">
  import { supabase } from './js/supabase-client.js';

  const { data: { session } } = await supabase.auth.getSession();

  let isPremium = false;

  if (session && session.user) {
    const { data: profile } = await supabase
      .from("users")
      .select("is_premium")
      .eq("id", session.user.id)
      .single();
    isPremium = profile?.is_premium === true;
  }

  const premiumCards = document.querySelectorAll("[data-premium='true']");

  if (!isPremium) {
    premiumCards.forEach(card => {
      card.classList.add("locked");

      // Add golden lock
      let lock = document.createElement("div");
      lock.className = "lock-icon";
      lock.textContent = "ğŸ”’";
      card.appendChild(lock);

      // On click: check auth status and show appropriate response
      card.addEventListener("click", async (e) => {
  e.preventDefault();

  const { data: { session: innerSession } } = await supabase.auth.getSession();

  if (!innerSession) {
    // NOT signed in â†’ show upgrade modal (SAME AS INDEX.HTML)
    const modal = document.getElementById("premiumModal");
    if (modal) {
      modal.classList.remove("hidden");
      modal.scrollIntoView({ behavior: "smooth", block: "center" });
    } else {
      window.location.href = "premium.html";
    }
    return;
  }

  // Signed in but NOT premium â†’ show upgrade modal
  const modal = document.getElementById("premiumModal");
  if (modal) {
    modal.classList.remove("hidden");
    modal.scrollIntoView({ behavior: "smooth", block: "center" });
  } else {
    window.location.href = "premium.html";
  }
});
    });
  }
  
  // Enable category grid after premium check is complete
  const categoriesGrid = document.getElementById('categoriesGrid');
  if (categoriesGrid) {
    categoriesGrid.style.pointerEvents = 'auto';
    categoriesGrid.style.opacity = '1';
  }
</script>

<!-- PREMIUM MODAL BUTTONS -->
<script>
  document.getElementById("closePremiumBtn").onclick = () => {
    const modal = document.getElementById("premiumModal");
    if (modal) modal.classList.add("hidden");
  };

  document.getElementById("goPremiumBtn").onclick = () => {
    window.location.href = "premium.html";
  };
</script>


<!-- Hamburger Menu Logic -->
<script>
const toggleBtn = document.getElementById("menuToggle");
const overlay = document.getElementById("menuOverlay");
const closeBtn = document.getElementById("closeMenu");

toggleBtn?.addEventListener("click", () => overlay.classList.add("active"));
closeBtn?.addEventListener("click", () => overlay.classList.remove("active"));

overlay.addEventListener("click", (e) => {
  if (e.target === overlay) overlay.classList.remove("active");
});
</script>

<script type="module">
  import { supabase } from './js/supabase-client.js';

  const { data: { session } } = await supabase.auth.getSession();

  // Hide Account if user not logged in
  if (!session || !session.user) {
    document.querySelectorAll('.menu-btn-account').forEach(btn => btn.remove());
  }

  // Hide Unlock All Categories if user is premium
  if (session && session.user) {
    const { data: profile } = await supabase
      .from('users')
      .select('is_premium')
      .eq('id', session.user.id)
      .single();

    if (profile?.is_premium) {
      document.querySelectorAll('.upgrade-access-btn').forEach(btn => btn.remove());
    }
  }
</script>


<!-- ğŸ” Search Modal -->
<div id="categorySearchModal" class="search-modal hidden">
  <div class="search-modal-content glass-box">
    <div class="search-header">
  <input type="text" id="liveSearchInput" placeholder="Start typing to search..." autofocus />
  <button class="close-search-modal" id="closeSearchModal">Ã—</button>
</div>
    <div class="search-results" id="searchResults">
      <!-- Dynamic Category Items Here -->
    </div>
  </div>
</div>

<script>
  const allCategories = [
    { name: "Altitude", slug: "altitude" },
    { name: "Beer Consumption", slug: "beer" },
    { name: "Coastline", slug: "coastline" },
    { name: "Crime Rate", slug: "crimerate" },
    { name: "Cuisine", slug: "cuisine" },
    { name: "Forest Cover", slug: "forest" },
    { name: "GDP Per Capita", slug: "gdp" },
    { name: "Happiness", slug: "happiness" },
    { name: "Highest Temperature", slug: "hightemp" },
    { name: "Land Mass", slug: "landmass" },
    { name: "Noble Prize Winners", slug: "nobelprize" },
    { name: "Olympic Medals", slug: "olympic" },
    { name: "Passport Strength", slug: "passport" },
    { name: "Population", slug: "population" },
    { name: "Rainfall", slug: "rainfall" },
    { name: "World Cup Trophies", slug: "worldcup" }
  ];

  const searchTrigger = document.getElementById('categorySearchInput');
  const searchModal = document.getElementById('categorySearchModal');
  const liveInput = document.getElementById('liveSearchInput');
  const searchResults = document.getElementById('searchResults');
  const closeSearchModal = document.getElementById('closeSearchModal');

  const renderSearchResults = (query = "") => {
    const normalized = query.toLowerCase();
    searchResults.innerHTML = "";
    allCategories
      .filter(cat => cat.name.toLowerCase().includes(normalized))
      .sort((a, b) => a.name.localeCompare(b.name))
      .forEach(cat => {
        const item = document.createElement("div");
        item.className = "search-item";
        // Close search modal and open mode selector
        item.onclick = () => {
          closeModal(); // Close search modal first
          setTimeout(() => {
            // Find the category emoji from the category cards
            const categoryCard = document.querySelector(`[data-category="${cat.slug}"]`);
            const emoji = categoryCard ? categoryCard.dataset.emoji : 'ğŸ®';
            window.openModeSelector(cat.slug, cat.name, emoji);
          }, 300); // Small delay to let search modal close
        };
        item.innerHTML = `
          <img src="images/categories/${cat.slug}.jpg" alt="${cat.name}" />
          <div class="info">${cat.name}</div>
        `;
        searchResults.appendChild(item);
      });
  };

  searchTrigger?.addEventListener('click', () => {
  searchModal.classList.remove("hidden");
  setTimeout(() => {
    liveInput.focus();
    renderSearchResults();
    const modalContent = document.querySelector('.search-modal-content');
    if (modalContent) {
      modalContent.scrollTo({ top: 0, behavior: 'instant' }); // Scrolls instantly to top
    }
  }, 100);
});

  const closeModal = () => {
  searchModal.classList.add("hidden");
  liveInput.value = "";
};

closeSearchModal?.addEventListener('click', closeModal);

searchModal?.addEventListener('click', (e) => {
  if (e.target === searchModal) {
    closeModal();
  }
});

  liveInput?.addEventListener('input', (e) => {
    renderSearchResults(e.target.value);
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      searchModal.classList.add("hidden");
      liveInput.value = "";
    }
  });
</script>

<!-- Mode Selector Modal Integration -->
<script type="module">
  import { openModeSelector } from './js/mode-selector.js';
  
  // Make openModeSelector globally accessible
  window.openModeSelector = openModeSelector;

  // Add click handlers to all category cards
  document.addEventListener('DOMContentLoaded', () => {
    const categoryCards = document.querySelectorAll('.category-card');
    
    categoryCards.forEach(card => {
      card.addEventListener('click', (e) => {
        // Don't open modal if card is locked (premium)
        if (card.classList.contains('locked')) {
          return; // Let the existing lock modal handle it
        }

        const category = card.dataset.category;
        const displayName = card.dataset.display;
        const emoji = card.dataset.emoji;

        // Open mode selector modal
        openModeSelector(category, displayName, emoji);
      });

      // Add cursor pointer style
      if (!card.classList.contains('locked')) {
        card.style.cursor = 'pointer';
      }
    });
  });
</script>


</body>
</html>