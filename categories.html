<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Categories - GeoRanks</title>
  <link rel="icon" href="assets/favicon.png" type="image/png">

  <!-- Fonts and Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/game-modes.css" />
  <link rel="stylesheet" href="css/home.css" />
  <link rel="stylesheet" href="css/mode-selector.css" />
  <style>
    /* Pagination Styles */
    .pagination-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 30px 0;
      padding: 20px;
    }

    .pagination-btn {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: white;
      font-family: 'Rubik', sans-serif;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .pagination-btn:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.4);
      transform: translateY(-2px);
    }

    .pagination-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .pagination-btn.active {
      background: rgba(74, 144, 226, 0.6);
      border-color: rgba(74, 144, 226, 0.8);
    }

    .page-number {
      min-width: 45px;
      padding: 10px 15px;
    }

    .page-info {
      color: rgba(255, 255, 255, 0.8);
      font-family: 'Rubik', sans-serif;
      font-size: 14px;
      margin: 0 10px;
    }
  </style>
</head>

<body>

<!-- üîí PREMIUM UPGRADE MODAL -->
<div id="premiumModal" class="premium-modal hidden">
  <div class="premium-window">
    <h2>Premium Feature <span class="lock">üîí</span></h2>
    <p>These categories are only available with <strong>GeoRanks Premium</strong>.</p>

    <button id="goPremiumBtn" class="premium-btn upgrade">Upgrade to Premium</button>
    <button id="closePremiumBtn" class="premium-btn cancel">Return Home</button>
  </div>
</div>

<!-- ========== HEADER (Leaderboard Style) ========== -->
<header class="home-glass-header">
  <div class="logo-header">
    <a href="index.html" class="logo-link">
      <img src="assets/logo.png" alt="GeoRanks Logo" />
    </a>
  </div>
  <div class="hamburger-menu">
    <div class="menu-icon" id="menuToggle">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
</header>

<div class="home-wrapper">

  <!-- Hamburger Overlay Menu -->
  <div class="menu-overlay" id="menuOverlay">
    <div class="menu-panel">
      <h2>Menu</h2>
      <button class="menu-btn" onclick="window.location.href='index.html'">üè† Home</button>
      <button class="menu-btn menu-btn-account" onclick="window.location.href='account.html'">üë§ Account</button>
      <button class="menu-btn" onclick="window.location.href='leaderboard.html'">üèÜ Leaderboard</button>
      <button class="menu-btn" onclick="window.location.href='stats.html'">üìä My Stats</button>
      <button class="menu-btn" onclick="window.location.href='how-to-play.html'">üí° How to Play</button>
      <button class="menu-btn" onclick="location.href='feedback.html'">üí¨ Feedback</button>
      <button class="menu-btn" onclick="location.href='contact.html'">üì© Contact Us</button>
      <button class="menu-btn upgrade-access-btn" onclick="window.location.href='premium.html'">üîì Unlock All Categories</button>
      <button class="menu-btn menu-close" id="closeMenu">Close</button>
    </div>
  </div>

  <!-- CATEGORIES -->
  <section class="categories-section">
    <h2>Explore All Categories üëá</h2>
    <!-- üîç Advanced Search Bar -->
<div class="search-bar-wrapper">
  <input type="text" id="categorySearchInput" placeholder="üîç Search Categories..." readonly />
</div>

    <div class="categories-grid" id="categoriesGrid" style="pointer-events: none; opacity: 0.6;">
      <!-- Categories will be dynamically rendered here -->
    </div>

    <!-- Pagination Controls -->
    <div class="pagination-container" id="paginationContainer">
      <button class="pagination-btn" id="prevBtn">‚Üê Previous</button>
      <span class="page-info" id="pageInfo">Page 1 of 2</span>
      <button class="pagination-btn page-number" data-page="1">1</button>
      <button class="pagination-btn page-number" data-page="2">2</button>
      <button class="pagination-btn" id="nextBtn">Next ‚Üí</button>
    </div>

  </section>
</div>

<script>
// All categories data (Page 1 + Page 2 placeholders)
const allCategoriesData = [
  // PAGE 1 - First 8 categories stay in place (FREE)
  { category: "population", display: "Population", emoji: "üë•", premium: false, image: "population.jpg" },
  { category: "gdp", display: "GDP Per Capita", emoji: "üíµ", premium: false, image: "gdp.jpg" },
  { category: "altitude", display: "Highest Altitude", emoji: "üèîÔ∏è", premium: false, image: "altitude.jpg" },
  { category: "forest", display: "Forest Cover", emoji: "üå≤", premium: false, image: "forest.jpg" },
  { category: "olympic", display: "Olympic Medals", emoji: "ü•á", premium: false, image: "olympic.jpg" },
  { category: "landmass", display: "Land Mass", emoji: "üåç", premium: false, image: "landmass.jpg" },
  { category: "passport", display: "Passport Strength", emoji: "üõÇ", premium: false, image: "passport.jpg" },
  { category: "beer", display: "Beer Consumption", emoji: "üç∫", premium: false, image: "beer.jpg" },
  
  // REMAINING 28 CATEGORIES - RANDOMLY SHUFFLED
  { category: "volcano", display: "Volcanoes", emoji: "üåã", premium: true, image: "volcano.jpg" },
  { category: "crimerate", display: "Crime Rate", emoji: "üö®", premium: true, image: "crimerate.jpg" },
  { category: "renewableenergy", display: "Renewable Energy", emoji: "‚ôªÔ∏è", premium: true, image: "renewableenergy.jpg" },
  { category: "tallestbuilding", display: "Tallest Building", emoji: "üèôÔ∏è", premium: true, image: "tallestbuilding.jpg" },
  { category: "nobelprize", display: "Nobel Prize Winners", emoji: "üïäÔ∏è", premium: true, image: "nobelprize.jpg" },
  { category: "flamingo", display: "Flamingos", emoji: "ü¶©", premium: true, image: "flamingo.jpg" },
  { category: "coastline", display: "Longest Coastline", emoji: "üèùÔ∏è", premium: true, image: "coastline.jpg" },
  { category: "rent", display: "Rent Prices", emoji: "üè†", premium: true, image: "rent.jpg" },
  { category: "lifeexpectancy", display: "Life Expectancy", emoji: "ü§ç", premium: true, image: "lifeexpectancy.jpg" },
  { category: "worldcup", display: "World Cup Trophies", emoji: "‚öΩ", premium: true, image: "worldcup.jpg" },
  { category: "michelin", display: "Michelin Restaurants", emoji: "‚≠ê", premium: true, image: "michelin.jpg" },
  { category: "density", display: "Population Density", emoji: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶", premium: true, image: "density.jpg" },
  
  // PAGE 2 CONTINUES
  { category: "university", display: "Most Universities", emoji: "üéì", premium: true, image: "university.jpg" },
  { category: "sexratio", display: "Gender Ratio", emoji: "‚öñÔ∏è", premium: true, image: "sexratio.jpg" },
  { category: "happiness", display: "Happiness", emoji: "üòä", premium: true, image: "happiness.jpg" },
  { category: "tourism", display: "Tourist Visits", emoji: "‚úàÔ∏è", premium: true, image: "tourism.jpg" },
  { category: "gm", display: "Grandmasters", emoji: "‚ôüÔ∏è", premium: true, image: "gm.jpg" },
  { category: "militarypersonel", display: "Military Personnel", emoji: "ü™ñ", premium: true, image: "militarypersonel.jpg" },
  { category: "precipitation", display: "Rainfall", emoji: "üåßÔ∏è", premium: true, image: "rainfall.jpg" },
  { category: "bigmac", display: "BigMac Index", emoji: "üçî", premium: true, image: "bigmac.jpg" },
  { category: "longestriver", display: "Longest River", emoji: "üåä", premium: true, image: "longestriver.jpg" },
  { category: "carexports", display: "Car Exports", emoji: "üöó", premium: true, image: "carexports.jpg" },
  { category: "disasterrisk", display: "Natural Disasters", emoji: "üå™Ô∏è", premium: true, image: "disasterrisk.jpg" },
  { category: "temperature", display: "Highest Temperature", emoji: "üå°Ô∏è", premium: true, image: "hightemp.jpg" },
  { category: "poorestgdp", display: "Poorest Countries", emoji: "üìâ", premium: true, image: "poorestgdp.jpg" },
  { category: "marriageage", display: "Marriage Age", emoji: "üíç", premium: true, image: "marriageage.jpg" },
  { category: "millionaires", display: "Millionaires", emoji: "üí∞", premium: true, image: "millionaires.jpg" },
  { category: "cuisine", display: "Cuisine", emoji: "üçΩÔ∏è", premium: true, image: "cuisine.jpg" }
];

const CATEGORIES_PER_PAGE = 20;
let currentPage = 1;

// Store user premium status globally
let userIsPremium = false;

function renderCategories(page) {
  const start = (page - 1) * CATEGORIES_PER_PAGE;
  const end = start + CATEGORIES_PER_PAGE;
  const pageCategories = allCategoriesData.slice(start, end);
  
  const categoriesGrid = document.getElementById('categoriesGrid');
  categoriesGrid.innerHTML = pageCategories.map(cat => `
    <div class="category-card" 
         data-category="${cat.category}" 
         data-display="${cat.display}" 
         data-emoji="${cat.emoji}"
         ${cat.premium ? 'data-premium="true"' : ''}
         style="background-image:url('images/categories/${cat.image}');">
      <div class="category-info">
        <span class="emoji">${cat.emoji}</span>
        <h3>${cat.display}</h3>
      </div>
    </div>
  `).join('');
  
  updatePagination();
  
  // Apply premium locks to newly rendered categories (use window reference)
  if (window.checkPremiumStatus) {
    window.checkPremiumStatus();
  }
  
  // Scroll to top smoothly
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function updatePagination() {
  const totalPages = Math.ceil(allCategoriesData.length / CATEGORIES_PER_PAGE);
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const pageInfo = document.getElementById('pageInfo');
  const pageButtons = document.querySelectorAll('.page-number');
  
  // Update page info
  pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
  
  // Update button states
  prevBtn.disabled = currentPage === 1;
  nextBtn.disabled = currentPage === totalPages;
  
  // Update page number buttons
  pageButtons.forEach(btn => {
    const page = parseInt(btn.dataset.page);
    if (page === currentPage) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });
}

// Pagination event listeners
document.getElementById('prevBtn').addEventListener('click', () => {
  if (currentPage > 1) {
    currentPage--;
    renderCategories(currentPage);
  }
});

document.getElementById('nextBtn').addEventListener('click', () => {
  const totalPages = Math.ceil(allCategoriesData.length / CATEGORIES_PER_PAGE);
  if (currentPage < totalPages) {
    currentPage++;
    renderCategories(currentPage);
  }
});

document.querySelectorAll('.page-number').forEach(btn => {
  btn.addEventListener('click', () => {
    currentPage = parseInt(btn.dataset.page);
    renderCategories(currentPage);
  });
});

// Initial render
renderCategories(currentPage);
</script>

<script type="module">
import { supabase } from './js/supabase-client.js';

async function checkPremiumStatus() {
  const { data: { session } } = await supabase.auth.getSession();
  
  if (!session || !session.user) {
    // Not signed in ‚Üí lock premium cards
    lockPremiumCategories();
    return;
  }

  // Signed in ‚Üí check premium
  const { data: profile } = await supabase
    .from('users')
    .select('is_premium')
    .eq('id', session.user.id)
    .single();

  if (!profile?.is_premium) {
    lockPremiumCategories();
  } else {
    // User is premium, unlock all categories
    document.querySelectorAll('.category-card[data-premium="true"]').forEach(card => {
      card.classList.remove('locked');
      const lock = card.querySelector('.lock-icon');
      if (lock) lock.remove();
    });
  }
}

function lockPremiumCategories() {
  document.querySelectorAll('.category-card[data-premium="true"]').forEach(card => {
    card.classList.add('locked');
    
    // Add golden lock if not already present
    if (!card.querySelector('.lock-icon')) {
      let lock = document.createElement("div");
      lock.className = "lock-icon";
      lock.textContent = "üîí";
      card.appendChild(lock);
    }
  });
}

// Make checkPremiumStatus globally accessible
window.checkPremiumStatus = checkPremiumStatus;

// Check premium status after categories are rendered
setTimeout(checkPremiumStatus, 100);

// Premium modal logic
document.addEventListener('click', async (e) => {
  const card = e.target.closest('.category-card');
  if (!card) return;

  // Check if category is locked
  if (card.classList.contains('locked')) {
    e.stopPropagation(); // Prevent mode selector from opening
    
    const modal = document.getElementById("premiumModal");
    if (modal) {
      modal.classList.remove("hidden");
      modal.style.display = 'flex'; // Ensure flex display for centering
      
      // Scroll the modal into view centered in viewport
      setTimeout(() => {
        const modalWindow = modal.querySelector('.premium-window');
        if (modalWindow) {
          modalWindow.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
        }
      }, 50);
    }
    return;
  }
});

// Enable category grid after premium check is complete
const categoriesGrid = document.getElementById('categoriesGrid');
if (categoriesGrid) {
  categoriesGrid.style.pointerEvents = 'auto';
  categoriesGrid.style.opacity = '1';
}
</script>

<!-- PREMIUM MODAL BUTTONS -->
<script>
  document.getElementById("closePremiumBtn").onclick = () => {
    const modal = document.getElementById("premiumModal");
    if (modal) {
      modal.classList.add("hidden");
      modal.style.display = 'none'; // Reset display
    }
  };

  document.getElementById("goPremiumBtn").onclick = () => {
    window.location.href = "premium.html";
  };
</script>


<!-- Hamburger Menu Logic -->
<script>
const toggleBtn = document.getElementById("menuToggle");
const overlay = document.getElementById("menuOverlay");
const closeBtn = document.getElementById("closeMenu");

toggleBtn?.addEventListener("click", () => overlay.classList.add("active"));
closeBtn?.addEventListener("click", () => overlay.classList.remove("active"));

overlay.addEventListener("click", (e) => {
  if (e.target === overlay) overlay.classList.remove("active");
});
</script>

<script type="module">
  import { supabase } from './js/supabase-client.js';

  const { data: { session } } = await supabase.auth.getSession();

  // Hide Account if user not logged in
  if (!session || !session.user) {
    document.querySelectorAll('.menu-btn-account').forEach(btn => btn.remove());
  }

  // Hide Unlock All Categories if user is premium
  if (session && session.user) {
    const { data: profile } = await supabase
      .from('users')
      .select('is_premium')
      .eq('id', session.user.id)
      .single();

    if (profile?.is_premium) {
      document.querySelectorAll('.upgrade-access-btn').forEach(btn => btn.remove());
    }
  }
</script>


<!-- üîç Search Modal -->
<div id="categorySearchModal" class="search-modal hidden">
  <div class="search-modal-content glass-box">
    <div class="search-header">
  <input type="text" id="liveSearchInput" placeholder="Start typing to search..." autofocus />
  <button class="close-search-modal" id="closeSearchModal">√ó</button>
</div>
    <div class="search-results" id="searchResults">
      <!-- Dynamic Category Items Here -->
    </div>
  </div>
</div>

<script>
  const allCategories = [
    { name: "Altitude", slug: "altitude" },
    { name: "Beer Consumption", slug: "beer" },
    { name: "BigMac Index", slug: "bigmac" },
    { name: "Coastline", slug: "coastline" },
    { name: "Crime Rate", slug: "crimerate" },
    { name: "Cuisine", slug: "cuisine" },
    { name: "Forest Cover", slug: "forest" },
    { name: "GDP Per Capita", slug: "gdp" },
    { name: "Happiness", slug: "happiness" },
    { name: "Highest Temperature", slug: "hightemp" },
    { name: "Land Mass", slug: "landmass" },
    { name: "Life Expectancy", slug: "lifeexpectancy" },
    { name: "Michelin Restaurants", slug: "michelin" },
    { name: "Noble Prize Winners", slug: "nobelprize" },
    { name: "Olympic Medals", slug: "olympic" },
    { name: "Passport Strength", slug: "passport" },
    { name: "Population", slug: "population" },
    { name: "Rainfall", slug: "rainfall" },
    { name: "Tourist Visits", slug: "tourism" },
    { name: "World Cup Trophies", slug: "worldcup" },
    // Page 2 - NEW ACTIVE CATEGORIES
    { name: "Marriage Age", slug: "marriageage" },
    { name: "Gender Ratio", slug: "sexratio" },
    { name: "Tallest Building", slug: "tallestbuilding" },
    { name: "Population Density", slug: "density" },
    { name: "Car Exports", slug: "carexports" },
    { name: "Military Personnel", slug: "militarypersonel" },
    { name: "Rent Prices", slug: "rent" },
    { name: "Poorest Countries", slug: "poorestgdp" },
    { name: "Most Universities", slug: "university" },
    { name: "Volcanoes", slug: "volcano" },
    { name: "Flamingos", slug: "flamingo" },
    { name: "Natural Disasters", slug: "disasterrisk" },
    { name: "Longest River", slug: "longestriver" },
    { name: "Renewable Energy", slug: "renewableenergy" },
    { name: "Millionaires", slug: "millionaires" },
    { name: "Grandmasters", slug: "gm" }
  ];

  const searchTrigger = document.getElementById('categorySearchInput');
  const searchModal = document.getElementById('categorySearchModal');
  const liveInput = document.getElementById('liveSearchInput');
  const searchResults = document.getElementById('searchResults');
  const closeSearchModal = document.getElementById('closeSearchModal');

  const renderSearchResults = (query = "") => {
    const normalized = query.toLowerCase();
    searchResults.innerHTML = "";
    allCategories
      .filter(cat => cat.name.toLowerCase().includes(normalized))
      .sort((a, b) => a.name.localeCompare(b.name))
      .forEach(cat => {
        const item = document.createElement("div");
        item.className = "search-item";
        // Close search modal and open mode selector or premium modal
        item.onclick = () => {
          closeModal(); // Close search modal first
          setTimeout(() => {
            // Find the category card to check if it's locked
            const categoryCard = document.querySelector(`[data-category="${cat.slug}"]`);
            
            // If category is locked, show premium modal instead
            if (categoryCard && categoryCard.classList.contains('locked')) {
              const modal = document.getElementById("premiumModal");
              if (modal) {
                modal.classList.remove("hidden");
                modal.style.display = 'flex'; // Ensure flex display for centering
                
                // Scroll the modal into view centered in viewport
                setTimeout(() => {
                  const modalWindow = modal.querySelector('.premium-window');
                  if (modalWindow) {
                    modalWindow.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
                  }
                }, 50);
              }
              return;
            }
            
            const emoji = categoryCard ? categoryCard.dataset.emoji : 'üéÆ';
            window.openModeSelector(cat.slug, cat.name, emoji, 'search'); // Pass 'search' as source
          }, 300); // Small delay to let search modal close
        };
        item.innerHTML = `
          <img src="images/categories/${cat.slug}.jpg" alt="${cat.name}" />
          <div class="info">${cat.name}</div>
        `;
        searchResults.appendChild(item);
      });
  };

  searchTrigger?.addEventListener('click', () => {
  searchModal.classList.remove("hidden");
  setTimeout(() => {
    liveInput.focus();
    renderSearchResults();
    const modalContent = document.querySelector('.search-modal-content');
    if (modalContent) {
      modalContent.scrollTo({ top: 0, behavior: 'instant' }); // Scrolls instantly to top
    }
  }, 100);
});

  const closeModal = () => {
  searchModal.classList.add("hidden");
  liveInput.value = "";
};

closeSearchModal?.addEventListener('click', closeModal);

searchModal?.addEventListener('click', (e) => {
  if (e.target === searchModal) {
    closeModal();
  }
});

  liveInput?.addEventListener('input', (e) => {
    renderSearchResults(e.target.value);
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      searchModal.classList.add("hidden");
      liveInput.value = "";
    }
  });
</script>

<!-- Mode Selector Modal Integration -->
<script type="module">
  import { openModeSelector } from './js/mode-selector.js';
  
  // Make openModeSelector globally accessible
  window.openModeSelector = openModeSelector;

  // Add click handlers to all category cards (delegated event listener)
  document.addEventListener('click', (e) => {
    const card = e.target.closest('.category-card');
    if (!card) return;
    
    // Don't open modal if card is locked (premium)
    if (card.classList.contains('locked')) {
      return; // Let the existing lock modal handle it
    }

    const category = card.dataset.category;
    const displayName = card.dataset.display;
    const emoji = card.dataset.emoji;

    // Open mode selector modal
    openModeSelector(category, displayName, emoji);
  });
</script>


</body>
</html>