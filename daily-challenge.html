<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Daily Challenge | GeoRanks</title>
  <link rel="icon" href="assets/favicon.png" type="image/png">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="css/game-modes.css" />
  <link rel="stylesheet" href="css/home.css"/>
  
  <style>
    body {
      background: linear-gradient(135deg, #a7f3d0 0%, #38bdf8 100%);
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    
    .daily-container {
      max-width: 600px;
      margin: 120px auto 60px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      padding: 50px 40px;
      border-radius: 24px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      text-align: center;
    }
    
    .daily-badge {
      display: inline-block;
      background: linear-gradient(135deg, #ff9770, #ff6f61);
      color: white;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .daily-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: #0d315a;
      margin-bottom: 15px;
      font-family: 'Poppins', sans-serif;
    }
    
    .daily-subtitle {
      font-size: 1.1rem;
      color: #6b7280;
      margin-bottom: 40px;
    }
    
    .challenge-card {
      position: relative;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      padding: 0;
      border-radius: 20px;
      margin-bottom: 30px;
      overflow: hidden;
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    
    .challenge-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
      z-index: 1;
    }
    
    .challenge-content {
      position: relative;
      z-index: 2;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      padding: 30px 25px;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      text-align: center;
      max-width: 90%;
    }
    
    .challenge-emoji {
      font-size: 3.5rem;
      margin-bottom: 10px;
    }
    
    .challenge-mode {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .challenge-category {
      font-size: 1.2rem;
      font-weight: 500;
      opacity: 0.95;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
    }
    
    .challenge-date {
      margin-top: 10px;
      font-size: 0.85rem;
      opacity: 0.8;
    }
    
    .play-button {
      background: linear-gradient(135deg, #ff9770, #ff6f61);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 50px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
    }
    
    .play-button:hover {
      transform: translateY(-3px);
    }
    
    .play-button:active {
      transform: translateY(0);
    }
    
    .completed-badge {
      background: #10b981;
      color: white;
      padding: 15px 30px;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 20px;
    }
    
    .back-button {
      background: #e5e7eb;
      color: #1f2937;
      border: none;
      padding: 12px 30px;
      border-radius: 50px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
    }
    
    .back-button:hover {
      background: #d1d5db;
    }
    
    .loading {
      font-size: 1.2rem;
      color: #6b7280;
      margin: 40px 0;
    }
    
    .error {
      background: #fee2e2;
      color: #dc2626;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    
    /* Mobile */
    @media (max-width: 768px) {
      .daily-container {
        margin: 90px 16px 40px;
        padding: 40px 25px;
      }
      
      .daily-title {
        font-size: 2rem;
      }
      
      .challenge-card {
        min-height: 250px;
      }
      
      .challenge-content {
        padding: 25px 20px;
        max-width: 95%;
      }
      
      .challenge-emoji {
        font-size: 2.8rem;
      }
      
      .challenge-mode {
        font-size: 1.4rem;
      }
      
      .challenge-category {
        font-size: 1rem;
      }
      
      .play-button {
        padding: 15px 40px;
        font-size: 1.1rem;
      }
    }

    /* Login Required Modal */
.auth-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 10000;
  align-items: center;
  justify-content: center;
}

.auth-modal.active {
  display: flex;
}

.auth-window {
  background: white;
  padding: 40px;
  border-radius: 20px;
  max-width: 450px;
  width: 90%;
  text-align: center;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.auth-window h2 {
  font-size: 2rem;
  color: #0d315a;
  margin-bottom: 15px;
  font-family: 'Poppins', sans-serif;
}

.auth-window p {
  font-size: 1.1rem;
  color: #6b7280;
  margin-bottom: 30px;
  line-height: 1.6;
}

.auth-window .lock {
  font-size: 2rem;
  margin-left: 8px;
}

.auth-btn {
  padding: 14px 30px;
  border: none;
  border-radius: 50px;
  font-size: 1.05rem;
  font-weight: 600;
  cursor: pointer;
  font-family: 'Poppins', sans-serif;
  transition: all 0.3s ease;
  margin: 8px;
}

.auth-btn.login {
  background: linear-gradient(135deg, #ff9770, #ff6f61);
  color: white;
  box-shadow: 0 6px 20px rgba(255, 111, 97, 0.3);
}

.auth-btn.login:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(255, 111, 97, 0.4);
}

.auth-btn.cancel {
  background: #e5e7eb;
  color: #1f2937;
}

.auth-btn.cancel:hover {
  background: #d1d5db;
}
  </style>
</head>
<body>
<!-- Login Required Modal -->
<div id="authModal" class="auth-modal">
  <div class="auth-window">
    <h2>Login Required <span class="lock">üîí</span></h2>
    <p>You need to be signed in to play the Daily Challenge!</p>
    <p style="font-size: 0.95rem; color: #9ca3af;">Create a free account to compete on the leaderboard and track your progress.</p>

    <button id="goLoginBtn" class="auth-btn login">Sign In / Sign Up</button>
    <button id="cancelLoginBtn" class="auth-btn cancel">Cancel</button>
  </div>
</div>

  <!-- GLASS HEADER -->
  <header class="home-glass-header">
    <div class="logo-header">
      <a href="index.html" class="logo-link">
        <img src="assets/logo.png" alt="GeoRanks Logo" />
      </a>
    </div>
    <div class="hamburger-menu">
      <div class="menu-icon" id="menuToggle">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>

  <div class="home-wrapper">
    <!-- Hamburger Overlay Menu -->
    <div class="menu-overlay" id="menuOverlay">
      <div class="menu-panel">
        <h2>Menu</h2>
        <button class="menu-btn" onclick="window.location.href='index.html'">üè† Home</button>
        <button class="menu-btn menu-btn-account" onclick="window.location.href='account.html'">üë§ Account</button>
        <button class="menu-btn" onclick="window.location.href='leaderboard.html'">üèÜ Leaderboard</button>
        <button class="menu-btn" onclick="window.location.href='stats.html'">üìä My Stats</button>
        <button class="menu-btn" onclick="window.location.href='how-to-play.html'">üí° How to Play</button>
        <button class="menu-btn" onclick="location.href='feedback.html'">üí¨ Feedback</button>
        <button class="menu-btn" onclick="location.href='contact.html'">üì© Contact Us</button>
        <button class="menu-btn upgrade-access-btn" onclick="window.location.href='premium.html'">üîì Unlock All Categories</button>
        <button class="menu-btn menu-close" id="closeMenu">Close</button>
      </div>
    </div>

    <!-- MAIN DAILY CHALLENGE CONTAINER -->
    <div class="daily-container">
      <div class="daily-badge">Daily Challenge</div>
      <h1 class="daily-title">Today's Challenge</h1>
      <p class="daily-subtitle" id="dateDisplay">Loading...</p>

      <!-- Loading State -->
      <div id="loadingState" class="loading">
        <p>Preparing your daily challenge...</p>
      </div>

      <!-- Challenge Card (Hidden until loaded) -->
      <div id="challengeCard" style="display: none;">
        <div class="challenge-card" id="challengeCardBg">
          <div class="challenge-content">
            <div class="challenge-emoji" id="challengeEmoji">üåç</div>
            <div class="challenge-mode" id="challengeMode">CLASSIC MODE</div>
            <div class="challenge-category" id="challengeCategory">Population</div>
            <div class="challenge-date" id="challengeDate">December 17, 2025</div>
          </div>
        </div>

        <button class="play-button" id="playButton">
          Start Challenge
        </button>

        <button class="back-button" onclick="window.location.href='index.html'">
          Home
        </button>
      </div>

      <!-- Completed State (Hidden until checked) -->
      <div id="completedState" style="display: none;">
        <div class="completed-badge">
          ‚úÖ Challenge Completed!
        </div>
        <p style="color: #6b7280; margin-bottom: 30px;">
          Come back tomorrow for a new challenge!
        </p>
        
        <button class="back-button" onclick="window.location.href='leaderboard.html'" style="margin-right: 10px;">
          üèÜ View Leaderboard
        </button>
        <button class="back-button" onclick="window.location.href='index.html'">
          üè† Home
        </button>
      </div>

      <!-- Error State (Hidden unless error) -->
      <div id="errorState" class="error" style="display: none;">
        <p><strong>‚ö†Ô∏è Error loading challenge</strong></p>
        <p id="errorMessage">Please try again later.</p>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <!-- Hamburger Menu Logic -->
  <script>
  const toggleBtn = document.getElementById("menuToggle");
  const overlay = document.getElementById("menuOverlay");
  const closeBtn = document.getElementById("closeMenu");

  toggleBtn?.addEventListener("click", () => overlay.classList.add("active"));
  closeBtn?.addEventListener("click", () => overlay.classList.remove("active"));

  overlay.addEventListener("click", (e) => {
    if (e.target === overlay) overlay.classList.remove("active");
  });
  </script>

  <script type="module">
    import { supabase } from './js/supabase-client.js';

    const { data: { session } } = await supabase.auth.getSession();

    // Hide Account if user not logged in
    if (!session || !session.user) {
      document.querySelectorAll('.menu-btn-account').forEach(btn => btn.remove());
    }

    // Hide Unlock All Categories if user is premium
    if (session && session.user) {
      const { data: profile } = await supabase
        .from('users')
        .select('is_premium')
        .eq('id', session.user.id)
        .single();

      if (profile?.is_premium) {
        document.querySelectorAll('.upgrade-access-btn').forEach(btn => btn.remove());
      }
    }
  </script>

  <!-- Daily Challenge Logic -->
  <script type="module">
    import { 
      getTodaysDailyChallenge, 
      hasCompletedTodaysChallenge,
      modeDisplayNames,
      categoryDisplayNames,
      categoryEmojis
    } from './js/daily-challenge.js';

    // Elements
    const loadingState = document.getElementById('loadingState');
    const challengeCard = document.getElementById('challengeCard');
    const completedState = document.getElementById('completedState');
    const errorState = document.getElementById('errorState');
    const dateDisplay = document.getElementById('dateDisplay');
    const playButton = document.getElementById('playButton');

    // Format today's date
    const today = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    dateDisplay.textContent = today.toLocaleDateString('en-US', options);

    // Initialize
    async function init() {
  try {
    // Check if user completed today's challenge
    const status = await hasCompletedTodaysChallenge();
    
    console.log('Challenge status:', status);
    
    // Check if user is logged in
    if (!status.loggedIn) {
      // Show login required modal
      loadingState.style.display = 'none';
      const authModal = document.getElementById('authModal');
      authModal.classList.add('active');
      
      // Setup modal buttons
      document.getElementById('goLoginBtn').onclick = () => {
        window.location.href = 'auth.html';
      };
      
      document.getElementById('cancelLoginBtn').onclick = () => {
        window.location.href = 'index.html';
      };
      
      return;
    }
    
    // Check if already completed
    if (status.completed) {
      loadingState.style.display = 'none';
      completedState.style.display = 'block';
      return;
    }

    // Get today's challenge
    const challenge = getTodaysDailyChallenge();
    console.log('Today\'s challenge:', challenge);

    // Update UI
    const modeElement = document.getElementById('challengeMode');
    const categoryElement = document.getElementById('challengeCategory');
    const emojiElement = document.getElementById('challengeEmoji');
    const dateElement = document.getElementById('challengeDate');
    const cardBg = document.getElementById('challengeCardBg');

    modeElement.textContent = modeDisplayNames[challenge.mode] || challenge.mode;
    categoryElement.textContent = categoryDisplayNames[challenge.category] || challenge.category;
    emojiElement.textContent = categoryEmojis[challenge.category] || 'üåç';
    dateElement.textContent = today.toLocaleDateString('en-US', options);

    // Set background image based on category
    const bgMap = {
      population: "population.jpg",
      gdp: "gdp.jpg",
      altitude: "altitude.jpg",
      forest: "forest.jpg",
      coastline: "coastline.jpg",
      olympic: "olympic.jpg",
      landmass: "landmass.jpg",
      passport: "passport.jpg",
      beer: "beer.jpg",
      nobelprize: "nobelprize.jpg",
      worldcup: "worldcup.jpg",
      hightemp: "hightemp.jpg",
      rainfall: "rainfall.jpg",
      crimerate: "crimerate.jpg",
      happiness: "happiness.jpg",
      cuisine: "cuisine.jpg",
      tourism: "tourism.jpg",
      michelin: "michelin.jpg",
      bigmac: "bigmac.jpg",
      lifeexpectancy: "lifeexpectancy.jpg",
    };

    const bgImage = bgMap[challenge.category];
    if (bgImage && cardBg) {
      cardBg.style.backgroundImage = `url('images/categories/${bgImage}')`;
    }

    // Set up play button
    playButton.onclick = () => {
      // Determine which game file to load
      let gameFile;
      if (challenge.mode === 'classic') {
        gameFile = 'game.html';
      } else if (challenge.mode === 'top10') {
        gameFile = 'top10.html';
      } else if (challenge.mode === 'vs') {
        gameFile = 'vs.html';
      }

      // Redirect with daily flag
      window.location.href = `${gameFile}?mode=${challenge.category}&daily=true`;
    };

    // Show challenge card
    loadingState.style.display = 'none';
    challengeCard.style.display = 'block';

  } catch (error) {
    console.error('Error initializing daily challenge:', error);
    loadingState.style.display = 'none';
    errorState.style.display = 'block';
    document.getElementById('errorMessage').textContent = error.message || 'Unknown error occurred';
  }
}

    // Run initialization
    init();
  </script>
</body>
</html>